{"version":3,"file":"PriceVsBaseline-BmNlO85R.js","sources":["../../src/components/charts/PriceVsBaseline.tsx"],"sourcesContent":["import {\n  CartesianGrid,\n  Legend,\n  Line,\n  LineChart,\n  ResponsiveContainer,\n  ReferenceLine,\n  Tooltip,\n  XAxis,\n  YAxis,\n} from \"recharts\";\nimport type { TimelinePoint } from \"../../model/history/types\";\nimport { HELP, HelpExpander, LimitationsBox } from \"../shared/HelpText\";\n\nfunction fmtPct(n: number): string {\n  const sign = n > 0 ? \"+\" : \"\";\n  return `${sign}${(n * 100).toFixed(1)}%`;\n}\n\nfunction fmtAUD(n: number): string {\n  return new Intl.NumberFormat(\"en-AU\", {\n    style: \"currency\",\n    currency: \"AUD\",\n    maximumFractionDigits: 0,\n  }).format(n);\n}\n\nexport function PriceVsBaseline({\n  title,\n  series,\n  dataKey,\n  baseValue,\n  cutoverYear,\n  onHoverYear,\n}: {\n  title: string;\n  series: TimelinePoint[];\n  dataKey: \"medianPrice\" | \"medianAnnualRent\";\n  baseValue: number;\n  cutoverYear?: number;\n  onHoverYear?: (year: number | null) => void;\n}) {\n  const isPrice = dataKey === \"medianPrice\";\n  const helpKey = isPrice ? \"priceIndex\" : \"rentIndex\";\n  const chartHelp = HELP.charts[helpKey];\n\n  const indexed = series\n    .map((s) => {\n      const v = (s as any)[dataKey] as number | undefined;\n      const idx = typeof v === \"number\" && baseValue > 0 ? (v / baseValue) * 100 : null;\n      // Back-compat: when we pass projected series without a `kind` field, treat it as projected.\n      const kind = (s as any).kind ?? \"projected\";\n      return {\n        year: (s as any).year,\n        kind,\n        value: v ?? null,\n        index: idx,\n        histIndex: kind === \"historical\" ? idx : null,\n        projIndex: kind === \"projected\" ? idx : null,\n      };\n    })\n    .filter((x) => x.year != null);\n\n  const first = indexed[0];\n  const last = indexed[indexed.length - 1];\n  const totalChange = last && first && first.value != null && last.value != null\n    ? (last.value - first.value) / first.value\n    : 0;\n  const avgAnnualChange = last && first && last.year > first.year && first.value != null && last.value != null\n    ? Math.pow(1 + totalChange, 1 / (last.year - first.year)) - 1\n    : 0;\n\n  // Color coding based on growth rate\n  const lineColor =\n    avgAnnualChange > 0.07 ? \"#dc2626\" :   // Red: very high growth\n    avgAnnualChange > 0.04 ? \"#ca8a04\" :   // Yellow: moderate growth\n    avgAnnualChange > 0.02 ? \"#16a34a\" :   // Green: low growth\n    \"#0369a1\";                              // Blue: negative/stable\n\n  return (\n    <div className=\"card\" style={{ padding: 14 }}>\n      <div className=\"h2\" style={{ marginBottom: 4 }}>\n        {title}\n      </div>\n      <div className=\"muted\" style={{ fontSize: 13, marginBottom: 6 }}>\n        {chartHelp.description}\n      </div>\n\n      {/* Key metrics summary */}\n      <div\n        style={{\n          display: \"flex\",\n          gap: 16,\n          marginBottom: 12,\n          padding: 10,\n          background: \"var(--bg-subtle)\",\n          borderRadius: 8,\n          fontSize: 13,\n        }}\n      >\n        <div>\n          <span className=\"muted\">Start:</span>{\" \"}\n          <strong>{fmtAUD(first?.value ?? 0)}</strong>\n        </div>\n        <div>\n          <span className=\"muted\">End:</span>{\" \"}\n          <strong>{fmtAUD(last?.value ?? 0)}</strong>\n        </div>\n        <div>\n          <span className=\"muted\">Total:</span>{\" \"}\n          <strong style={{ color: lineColor }}>{fmtPct(totalChange)}</strong>\n        </div>\n        <div>\n          <span className=\"muted\">Annual avg:</span>{\" \"}\n          <strong>{fmtPct(avgAnnualChange)}/yr</strong>\n        </div>\n      </div>\n\n      <div style={{ width: \"100%\", height: 260 }}>\n        <ResponsiveContainer>\n          <LineChart\n            data={indexed}\n            margin={{ top: 10, right: 10, bottom: 10, left: 0 }}\n            onMouseMove={(e: any) => {\n              const y = e?.activeLabel;\n              if (typeof y === \"number\") onHoverYear?.(y);\n            }}\n            onMouseLeave={() => onHoverYear?.(null)}\n          >\n            <CartesianGrid strokeDasharray=\"3 3\" stroke=\"#e5e7eb\" />\n            <XAxis\n              dataKey=\"year\"\n              tick={{ fontSize: 11 }}\n              tickLine={false}\n              axisLine={{ stroke: \"#e5e7eb\" }}\n            />\n            <YAxis\n              domain={[\"auto\", \"auto\"]}\n              tickFormatter={(v) => `${v}`}\n              label={{\n                value: \"Index (start=100)\",\n                angle: -90,\n                position: \"insideLeft\",\n                style: { fontSize: 11, fill: \"#6b7280\" },\n              }}\n              tick={{ fontSize: 11 }}\n              tickLine={false}\n              axisLine={{ stroke: \"#e5e7eb\" }}\n            />\n            <Tooltip\n              formatter={(value, name) => {\n                if (typeof value !== \"number\") return [value, name];\n                if (name === \"Nominal value\") return [fmtAUD(value), name];\n                return [value.toFixed(1), name];\n              }}\n              labelFormatter={(l) => `Year ${l}`}\n              contentStyle={{\n                borderRadius: 8,\n                border: \"1px solid var(--border)\",\n                fontSize: 12,\n              }}\n            />\n            <Legend wrapperStyle={{ fontSize: 12 }} />\n            <Line\n              type=\"monotone\"\n              dataKey=\"histIndex\"\n              name={isPrice ? \"Historical\" : \"Historical\"}\n              stroke=\"#94a3b8\"\n              strokeWidth={2}\n              dot={false}\n              isAnimationActive={false}\n            />\n            <Line\n              type=\"monotone\"\n              dataKey=\"projIndex\"\n              name={isPrice ? \"Projected\" : \"Projected\"}\n              stroke={lineColor}\n              strokeWidth={3}\n              dot={false}\n              activeDot={{ r: 5, fill: lineColor }}\n            />\n            {/* Reference line at 100 */}\n            <ReferenceLine y={100} stroke=\"#9ca3af\" strokeDasharray=\"4 4\" />\n            {cutoverYear != null && (\n              <ReferenceLine\n                x={cutoverYear}\n                stroke=\"#9ca3af\"\n                strokeDasharray=\"3 3\"\n                label={{ value: \"Model starts\", position: \"insideTop\", fontSize: 10, fill: \"#6b7280\" }}\n              />\n            )}\n          </LineChart>\n        </ResponsiveContainer>\n      </div>\n\n      <HelpExpander summary=\"How to interpret this chart\">\n        <p style={{ margin: \"0 0 8px 0\" }}>{chartHelp.interpretation}</p>\n        <ul style={{ margin: 0, paddingLeft: 16 }}>\n          <li>Index starts at 100 in year 0</li>\n          <li>Index of 150 = 50% higher than starting value</li>\n          <li>Index of 200 = doubled from starting value</li>\n          <li>Dashed line shows the starting baseline for reference</li>\n        </ul>\n      </HelpExpander>\n\n      <HelpExpander summary=\"Color coding\">\n        <ul style={{ margin: 0, paddingLeft: 16 }}>\n          <li><span style={{ color: \"#dc2626\" }}>■</span> Red: Very high growth ({\">\"}7%/year) — affordability worsening rapidly</li>\n          <li><span style={{ color: \"#ca8a04\" }}>■</span> Yellow: Moderate growth (4-7%/year) — faster than wages typically grow</li>\n          <li><span style={{ color: \"#16a34a\" }}>■</span> Green: Low growth (2-4%/year) — roughly tracking inflation</li>\n          <li><span style={{ color: \"#0369a1\" }}>■</span> Blue: Stable/declining ({\"<\"}2%/year) — improving affordability</li>\n        </ul>\n      </HelpExpander>\n\n      <LimitationsBox items={[chartHelp.limitations]} />\n    </div>\n  );\n}\n"],"names":["fmtPct","fmtAUD","PriceVsBaseline","title","series","dataKey","baseValue","cutoverYear","onHoverYear","isPrice","helpKey","chartHelp","HELP","indexed","s","v","idx","kind","x","first","last","totalChange","avgAnnualChange","lineColor","jsxs","jsx","ResponsiveContainer","LineChart","e","y","CartesianGrid","XAxis","YAxis","Tooltip","value","name","l","Legend","Line","ReferenceLine","HelpExpander","LimitationsBox"],"mappings":"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"}