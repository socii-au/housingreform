{"version":3,"mappings":"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","names":["DANGEROUS_KEYS","isSafeKey","k","isPlainObject","value","proto","nullProtoObject","sanitizeNumber","x","opts","n","min","max","sanitizeHistoryBundle","input","startYear","endYear","byCityRaw","metaRaw","allowed","CITIES","c","byCity","s","years","y","pickArr","name","a","v","num","meta","sanitizeHistoryBundleWithReport","droppedCityKeys","keptCityKeys","droppedPoints","cappedPoints","sanitized","f","PARTY_META","PARTY_ORDER","PartyChip","party","jsx","PRESET_PARTIES","GROUP_PARTIES","POLICY_KEY_PARTIES","summarizePartySupport","parties","counts","p","top","fmtPctPoints","sign","abs","StatusChip","tone","text","ControlGroup","title","icon","defaultOpen","children","open","setOpen","useState","toneClass","jsxs","SliderField","label","step","onChange","format","tooltip","formatted","InfoTooltip","e","ControlsPanel","params","scope","patchPolicy","setYears","selectNational","selectState","selectCity","applyPreset","togglePreset","presetId","selectedPresets","resetToDefaults","includeAllCities","toggleCityCoverage","engine","setEngine","showHistory","setShowHistory","historyIndexBase","setHistoryIndexBase","ratePath","setRatePath","autoRba","setAutoRba","autoRbaMessage","useModel","policy","toPolicyV2","calibrationEnabled","expertMode","setExpertMode","scopeValue","handleScopeChange","val","citiesWithState","totalCitiesShown","ALL_STATES","st","STATE_NAMES","HELP","Fragment","pp","pct","pickBaseYear","h0","valueAtYear","points","year","aggregateHistorical","included","cityScope","stateScope","cityMeta","_","i","fallbackPop","out","parts","idx","popWeights","wSum","b","w","wAvg","xs","ws","pop","stock","price","rent","wage","stampDutyRevenue","computeStampDutyRevenue","buildRegionTimeline","projected","scopeKey","historyAvailable","history","baseYear","basePrice","baseRent","baseWage","base","historicalWithIndex","projectedWithKind","cutoverYear","histYears","joined","metaWarnings","AustraliaCrisisMap","lazy","__vitePreload","m","PriceVsBaseline","WageVsHousingChart","DwellingStockArea","DecileImpact","PolicyChannelsFlow","SummaryCounter","MicrodataWarningsBanner","micro","enabled","warnings","inferred","assessPolicyDifficulty","score","factors","severityFromCount","rating","ScopeIndicator","cityCount","scopeLabel","CalibrationWarningsBanner","calibrationReport","activeCalibrationFirst","listCalibrationFirstActive","atBounds","listAtBounds","calEnabled","hasHistory","HistoryWarningsBanner","bundle","notes","SanitizationBanner","msgs","hb","rep","ExploreModel","scopedView","selectedCityData","outputs","focusYear","setFocusYear","first","decileRows","resolveMethodology","timelineView","chartSeries","selectedYear","baseValueForIndex","basePoint","defaultPolicy","DEFAULT_POLICY_LEVERS_V2","policyDifficulty","getByPath","obj","path","acc","key","formatPolicyValue","manualChanges","changes","POLICY_PARAMS","param","current","baseline","activePresets","presetParties","manualParties","partySummary","partyKeyLabel","Suspense","HelpExpander","items","severity"],"ignoreList":[],"sources":["../../src/security/sanitize.ts","../../src/components/policyParty.tsx","../../src/components/ControlsPanel.tsx","../../src/model/history/timeline.ts","../../src/routes/ExploreModel.tsx"],"sourcesContent":["import { CITIES, type CityId } from \"../model/regions\";\nimport type { RecordLike } from \"../model/microdata/importers\";\nimport type { HistoryBundle } from \"../model/history/types\";\n\nconst DANGEROUS_KEYS = new Set([\"__proto__\", \"prototype\", \"constructor\"]);\n\nexport function isSafeKey(k: string): boolean {\n  return !DANGEROUS_KEYS.has(k);\n}\n\nexport function isPlainObject(value: unknown): value is Record<string, unknown> {\n  if (value == null || typeof value !== \"object\") return false;\n  const proto = Object.getPrototypeOf(value);\n  return proto === Object.prototype || proto === null;\n}\n\nexport function nullProtoObject<T extends object = Record<string, unknown>>(): T {\n  return Object.create(null) as T;\n}\n\nexport function sanitizeByCityRowsMap(input: unknown, opts?: { maxRowsPerCity?: number }): Partial<Record<CityId, RecordLike[]>> {\n  const out: Partial<Record<CityId, RecordLike[]>> = nullProtoObject();\n  if (!isPlainObject(input)) return out;\n  const allowed = new Set(CITIES.map((c) => c.id));\n  const maxRows = Math.max(1000, Math.floor(opts?.maxRowsPerCity ?? 50_000));\n\n  Object.keys(input).forEach((k) => {\n    if (!isSafeKey(k)) return;\n    if (!allowed.has(k as CityId)) return;\n    const v = (input as any)[k];\n    if (!Array.isArray(v)) return;\n    // Only keep plain-object rows; hard cap to avoid DoS.\n    const rows = v\n      .slice(0, maxRows)\n      .filter((r) => isPlainObject(r));\n    out[k as CityId] = rows as RecordLike[];\n  });\n\n  return out;\n}\n\nexport function sanitizeByCityRowsMapWithReport(\n  input: unknown,\n  opts?: { maxRowsPerCity?: number }\n): {\n  sanitized: Partial<Record<CityId, RecordLike[]>>;\n  report: {\n    droppedCityKeys: number;\n    keptCityKeys: number;\n    droppedRows: number;\n    truncatedRows: number;\n    maxRowsPerCity: number;\n  };\n} {\n  const allowed = new Set(CITIES.map((c) => c.id));\n  const maxRows = Math.max(1000, Math.floor(opts?.maxRowsPerCity ?? 50_000));\n\n  const sanitized: Partial<Record<CityId, RecordLike[]>> = nullProtoObject();\n  let droppedCityKeys = 0;\n  let keptCityKeys = 0;\n  let droppedRows = 0;\n  let truncatedRows = 0;\n\n  if (!isPlainObject(input)) {\n    return { sanitized, report: { droppedCityKeys: 0, keptCityKeys: 0, droppedRows: 0, truncatedRows: 0, maxRowsPerCity: maxRows } };\n  }\n\n  Object.keys(input).forEach((k) => {\n    if (!isSafeKey(k) || !allowed.has(k as CityId)) {\n      droppedCityKeys++;\n      return;\n    }\n    const v = (input as any)[k];\n    if (!Array.isArray(v)) {\n      droppedCityKeys++;\n      return;\n    }\n    const slice = v.slice(0, maxRows);\n    if (v.length > maxRows) truncatedRows += v.length - maxRows;\n    const rows = slice.filter((r) => isPlainObject(r));\n    droppedRows += slice.length - rows.length;\n    sanitized[k as CityId] = rows as RecordLike[];\n    keptCityKeys++;\n  });\n\n  return { sanitized, report: { droppedCityKeys, keptCityKeys, droppedRows, truncatedRows, maxRowsPerCity: maxRows } };\n}\n\nexport function sanitizeStringMap(input: unknown, opts?: { maxKeys?: number; maxKeyLen?: number; maxValLen?: number }): Record<string, string> {\n  const out: Record<string, string> = nullProtoObject();\n  if (!isPlainObject(input)) return out;\n  const maxKeys = Math.max(10, Math.floor(opts?.maxKeys ?? 200));\n  const maxKeyLen = Math.max(4, Math.floor(opts?.maxKeyLen ?? 80));\n  const maxValLen = Math.max(4, Math.floor(opts?.maxValLen ?? 200));\n\n  let n = 0;\n  for (const k of Object.keys(input)) {\n    if (n >= maxKeys) break;\n    if (!isSafeKey(k)) continue;\n    if (k.length > maxKeyLen) continue;\n    const v = (input as any)[k];\n    if (typeof v !== \"string\") continue;\n    out[k] = v.slice(0, maxValLen);\n    n++;\n  }\n  return out;\n}\n\nexport function sanitizeNumber(x: unknown, opts?: { min?: number; max?: number }): number | null {\n  const n = typeof x === \"number\" ? x : typeof x === \"string\" ? Number(x.trim()) : NaN;\n  if (!Number.isFinite(n)) return null;\n  const min = opts?.min;\n  const max = opts?.max;\n  if (typeof min === \"number\" && n < min) return min;\n  if (typeof max === \"number\" && n > max) return max;\n  return n;\n}\n\nexport function safeStructuredClone<T>(x: T): T {\n  // structuredClone is available in modern browsers; fallback strips prototypes via JSON.\n  try {\n    if (typeof structuredClone === \"function\") return (structuredClone as typeof globalThis.structuredClone)(x);\n  } catch {\n    // ignore\n  }\n  return JSON.parse(JSON.stringify(x)) as T;\n}\n\nexport function sanitizeHistoryBundle(input: unknown): HistoryBundle | null {\n  if (!isPlainObject(input)) return null;\n  const startYear = sanitizeNumber((input as any).startYear, { min: 1800, max: 2600 });\n  const endYear = sanitizeNumber((input as any).endYear, { min: 1800, max: 2600 });\n  const byCityRaw = (input as any).byCity;\n  const metaRaw = (input as any).meta;\n  if (startYear == null || endYear == null) return null;\n  if (!isPlainObject(byCityRaw)) return null;\n\n  const allowed = new Set(CITIES.map((c) => c.id));\n  const byCity: any = nullProtoObject();\n  for (const k of Object.keys(byCityRaw)) {\n    if (!isSafeKey(k)) continue;\n    if (!allowed.has(k as CityId)) continue;\n    const s = (byCityRaw as any)[k];\n    if (!isPlainObject(s)) continue;\n    const years = Array.isArray((s as any).years) ? (s as any).years.slice(0, 400).map((y: any) => sanitizeNumber(y, { min: 1800, max: 2600 })) : null;\n    if (!years || years.some((y: any) => y == null)) continue;\n    const n = years.length;\n    const pickArr = (name: string) => {\n      const a = (s as any)[name];\n      if (!Array.isArray(a)) return undefined;\n      if (a.length !== n) return undefined;\n      return a.map((v: any) => {\n        if (v == null) return null;\n        const num = sanitizeNumber(v, { min: 0 });\n        return num == null ? null : num;\n      });\n    };\n    byCity[k] = {\n      years: years as any,\n      medianPrice: pickArr(\"medianPrice\"),\n      medianAnnualRent: pickArr(\"medianAnnualRent\"),\n      medianAnnualWage: pickArr(\"medianAnnualWage\"),\n      population: pickArr(\"population\"),\n      dwellingStock: pickArr(\"dwellingStock\"),\n    };\n  }\n\n  // Meta is optional; if present, strip unsafe keys.\n  const meta = isPlainObject(metaRaw)\n    ? {\n        notes: Array.isArray((metaRaw as any).notes) ? (metaRaw as any).notes.slice(0, 50).filter((x: any) => typeof x === \"string\").map((x: string) => x.slice(0, 240)) : [],\n        warnings: Array.isArray((metaRaw as any).warnings) ? (metaRaw as any).warnings.slice(0, 50).filter((x: any) => typeof x === \"string\").map((x: string) => x.slice(0, 240)) : [],\n        byCity: nullProtoObject(),\n      }\n    : { notes: [], warnings: [], byCity: nullProtoObject() };\n\n  return {\n    startYear: startYear as any,\n    endYear: endYear as any,\n    byCity,\n    meta: meta as any,\n  } as HistoryBundle;\n}\n\nexport function sanitizeHistoryBundleWithReport(input: unknown): {\n  sanitized: HistoryBundle | null;\n  report: {\n    ok: boolean;\n    droppedCityKeys: number;\n    keptCityKeys: number;\n    droppedPoints: number;\n    cappedPoints: number;\n    maxYears: number;\n  };\n} {\n  const maxYears = 400;\n  let droppedCityKeys = 0;\n  let keptCityKeys = 0;\n  let droppedPoints = 0;\n  let cappedPoints = 0;\n\n  const sanitized = sanitizeHistoryBundle(input);\n  if (!sanitized) {\n    return { sanitized: null, report: { ok: false, droppedCityKeys: 0, keptCityKeys: 0, droppedPoints: 0, cappedPoints: 0, maxYears } };\n  }\n\n  // Shallow report on byCity coverage.\n  const allowed = new Set(CITIES.map((c) => c.id));\n  if (isPlainObject((input as any)?.byCity)) {\n    Object.keys((input as any).byCity).forEach((k) => {\n      if (!isSafeKey(k) || !allowed.has(k as CityId)) droppedCityKeys++;\n      else keptCityKeys++;\n    });\n  }\n\n  // Cap years length in the sanitized object (defensive).\n  Object.keys(sanitized.byCity as any).forEach((k) => {\n    const s = (sanitized.byCity as any)[k];\n    const n = Array.isArray(s?.years) ? s.years.length : 0;\n    if (n > maxYears) {\n      cappedPoints += n - maxYears;\n      s.years = s.years.slice(0, maxYears);\n      ([\"medianPrice\", \"medianAnnualRent\", \"medianAnnualWage\", \"population\", \"dwellingStock\"] as const).forEach((f) => {\n        if (Array.isArray(s[f])) s[f] = s[f].slice(0, maxYears);\n      });\n    }\n  });\n\n  return { sanitized, report: { ok: true, droppedCityKeys, keptCityKeys, droppedPoints, cappedPoints, maxYears } };\n}\n","export type PartyKey = \"labor\" | \"coalition\" | \"greens\" | \"nationals\" | \"independent\" | \"bipartisan\";\n\nexport const PARTY_META: Record<PartyKey, { label: string; color: string; textColor: string }> = {\n  labor: { label: \"Labor\", color: \"#d11a2a\", textColor: \"#ffffff\" },\n  coalition: { label: \"Coalition\", color: \"#0038a8\", textColor: \"#ffffff\" },\n  greens: { label: \"Greens\", color: \"#0ea34a\", textColor: \"#ffffff\" },\n  nationals: { label: \"Nationals\", color: \"#f4c430\", textColor: \"#1f2937\" },\n  independent: { label: \"Independents\", color: \"#7c3aed\", textColor: \"#ffffff\" },\n  bipartisan: { label: \"Bipartisan/Regulators\", color: \"#6b7280\", textColor: \"#ffffff\" },\n};\n\nexport const PARTY_ORDER: PartyKey[] = [\"labor\", \"coalition\", \"greens\", \"nationals\", \"independent\", \"bipartisan\"];\n\nexport function PartyChip({ party }: { party: PartyKey }) {\n  const meta = PARTY_META[party];\n  return (\n    <span\n      style={{\n        display: \"inline-flex\",\n        alignItems: \"center\",\n        padding: \"2px 8px\",\n        borderRadius: 999,\n        fontSize: 11,\n        fontWeight: 700,\n        background: meta.color,\n        color: meta.textColor,\n        letterSpacing: 0.2,\n      }}\n      aria-label={`Party support: ${meta.label}`}\n      title={`Party support: ${meta.label}`}\n    >\n      {meta.label}\n    </span>\n  );\n}\n\nexport const PRESET_PARTIES: Record<string, PartyKey[]> = {\n  \"ng-remove\": [\"labor\"],\n  \"ng-remove-fast\": [\"greens\"],\n  \"ng-restore\": [\"coalition\"],\n  \"ownership-cap\": [\"greens\"],\n  \"ownership-cap-aggressive\": [\"greens\"],\n  \"supply-boost\": [\"labor\"],\n  comprehensive: [\"independent\"],\n  \"land-tax-transition\": [\"coalition\"],\n  \"macroprudential-tightening\": [\"bipartisan\"],\n  \"short-stay-clampdown\": [\"greens\"],\n  \"public-housing-build\": [\"labor\"],\n  \"migration-shock-down\": [\"coalition\"],\n  \"all-levers\": [\"independent\"],\n};\n\nexport const GROUP_PARTIES: Record<string, PartyKey[]> = {\n  \"Negative Gearing\": [\"labor\", \"greens\", \"coalition\"],\n  \"Ownership Cap\": [\"greens\"],\n  \"Supply & Demand\": [\"labor\", \"coalition\"],\n  \"Tax & investor incentives\": [\"coalition\"],\n  \"Credit / macro-prudential\": [\"bipartisan\"],\n  \"Demand-side subsidies\": [\"labor\"],\n  \"Rental settings\": [\"greens\", \"labor\"],\n  \"Planning / infrastructure\": [\"coalition\", \"labor\"],\n  \"Public & community housing\": [\"labor\", \"greens\"],\n  \"Population\": [\"coalition\"],\n};\n\nexport const POLICY_KEY_PARTIES: Record<string, PartyKey[]> = {\n  \"negativeGearingMode\": [\"labor\", \"greens\", \"coalition\"],\n  \"negativeGearingIntensity\": [\"labor\", \"greens\", \"coalition\"],\n  \"ownershipCapEnabled\": [\"greens\"],\n  \"ownershipCapEnforcement\": [\"greens\"],\n  \"excessInvestorStockShare\": [\"greens\"],\n  \"divestmentPhased\": [\"greens\"],\n  \"supplyBoost\": [\"labor\", \"coalition\"],\n  \"demandReduction\": [\"labor\", \"coalition\"],\n  \"rentGrowthModifier\": [\"greens\", \"labor\"],\n  \"taxInvestor.cgtDiscountDelta\": [\"coalition\"],\n  \"taxInvestor.landTaxShift\": [\"coalition\"],\n  \"taxInvestor.vacancyTaxIntensity\": [\"coalition\"],\n  \"taxInvestor.shortStayRegulationIntensity\": [\"greens\"],\n  \"taxInvestor.foreignBuyerRestrictionIntensity\": [\"coalition\"],\n  \"credit.serviceabilityBufferDelta\": [\"bipartisan\"],\n  \"credit.dtiCapTightness\": [\"bipartisan\"],\n  \"credit.investorLendingLimitTightness\": [\"bipartisan\"],\n  \"subsidies.firstHomeBuyerSubsidyIntensity\": [\"labor\"],\n  \"rental.rentAssistanceIntensity\": [\"labor\"],\n  \"rental.rentRegulationCap\": [\"greens\"],\n  \"rental.rentRegulationCoverage\": [\"greens\"],\n  \"rental.vacancyDecontrol\": [\"greens\"],\n  \"planning.upzoningIntensity\": [\"coalition\", \"labor\"],\n  \"planning.infrastructureEnablement\": [\"coalition\", \"labor\"],\n  \"planning.infrastructureLagYears\": [\"coalition\", \"labor\"],\n  \"publicCommunity.publicHousingBuildBoost\": [\"labor\", \"greens\"],\n  \"publicCommunity.publicHousingAcquisitionSharePerYear\": [\"labor\", \"greens\"],\n  \"publicCommunity.conversionToSocialSharePerYear\": [\"labor\", \"greens\"],\n  \"migration.netOverseasMigrationShock\": [\"coalition\"],\n  \"stampDutyRateDelta\": [\"coalition\"],\n  \"mortgageRateDelta\": [\"bipartisan\"],\n  \"rampYears\": [\"bipartisan\"],\n};\n\nexport function summarizePartySupport(parties: PartyKey[]): { counts: Record<PartyKey, number>; top: PartyKey[] } {\n  const counts = {} as Record<PartyKey, number>;\n  PARTY_ORDER.forEach((p) => {\n    counts[p] = 0;\n  });\n  parties.forEach((p) => {\n    counts[p] = (counts[p] ?? 0) + 1;\n  });\n  const max = Math.max(0, ...Object.values(counts));\n  const top = max > 0 ? PARTY_ORDER.filter((p) => counts[p] === max) : [];\n  return { counts, top };\n}\n","import { useState } from \"react\";\nimport { useModel, scopeLabel } from \"../model/ModelContext\";\nimport { SCENARIO_PRESETS, ALL_STATES, STATE_NAMES, CITIES } from \"../model/types\";\nimport type { NegativeGearingMode, StateId, CityId } from \"../model/types\";\nimport { HELP, InfoTooltip } from \"./shared/HelpText\";\nimport { toPolicyV2 } from \"../model/policyRegistry\";\nimport { GROUP_PARTIES, PARTY_ORDER, PartyChip, PRESET_PARTIES } from \"./policyParty\";\n\nfunction fmtPct(n: number): string {\n  const sign = n >= 0 ? \"+\" : \"\";\n  return `${sign}${Math.round(n * 100)}%`;\n}\n\nfunction fmtPctPoints(n: number): string {\n  const sign = n > 0 ? \"+\" : n < 0 ? \"\" : \"\";\n  const abs = Math.abs(n);\n  const s = Number.isInteger(abs) ? abs.toFixed(0) : abs.toFixed(1);\n  return `${sign}${s}%`;\n}\n\nfunction StatusChip({ tone, text }: { tone: \"success\" | \"warning\" | \"info\"; text: string }) {\n  return <span className={`chip tone-${tone}`}>{text}</span>;\n}\n\nfunction ControlGroup({\n  title,\n  icon,\n  defaultOpen = true,\n  tone,\n  children,\n}: {\n  title: string;\n  icon: string;\n  defaultOpen?: boolean;\n  tone?: \"warning\" | \"success\" | \"info\";\n  children: React.ReactNode;\n}) {\n  const [open, setOpen] = useState(defaultOpen);\n  const toneClass = tone ? `tone-${tone}` : \"\";\n\n  return (\n    <div className={`control-group ${toneClass}`}>\n      <button\n        type=\"button\"\n        className=\"control-group-header\"\n        onClick={() => setOpen(!open)}\n        aria-expanded={open}\n      >\n        <span className=\"control-group-icon\">{icon}</span>\n        <span className=\"control-group-title\">{title}</span>\n        <span className=\"control-group-chevron\">{open ? \"\" : \"\"}</span>\n      </button>\n      {open && <div className=\"control-group-body\">{children}</div>}\n    </div>\n  );\n}\n\nfunction SliderField({\n  label,\n  value,\n  min,\n  max,\n  step,\n  onChange,\n  format,\n  tooltip,\n}: {\n  label: string;\n  value: number;\n  min: number;\n  max: number;\n  step: number;\n  onChange: (v: number) => void;\n  format?: (v: number) => string;\n  tooltip?: string;\n}) {\n  const formatted = format ? format(value) : String(value);\n  return (\n    <div className=\"slider-field\">\n      <div className=\"slider-field-label\">\n        <span>{label}: <strong>{formatted}</strong></span>\n        {tooltip && <InfoTooltip text={tooltip} />}\n      </div>\n      <input\n        type=\"range\"\n        min={min}\n        max={max}\n        step={step}\n        value={value}\n        onChange={(e) => onChange(Number(e.target.value))}\n      />\n    </div>\n  );\n}\n\nexport function ControlsPanel() {\n  const {\n    params,\n    scope,\n    patchPolicy,\n    setYears,\n    selectNational,\n    selectState,\n    selectCity,\n    applyPreset,\n    togglePreset,\n    presetId,\n    selectedPresets,\n    resetToDefaults,\n    includeAllCities,\n    toggleCityCoverage,\n    engine,\n    setEngine,\n    showHistory,\n    setShowHistory,\n    historyIndexBase,\n    setHistoryIndexBase,\n    ratePath,\n    setRatePath,\n    autoRba,\n    setAutoRba,\n    autoRbaMessage,\n  } = useModel();\n\n  const policy = toPolicyV2(params.policy as any);\n  const calibrationEnabled =\n    !!params.advanced?.calibration?.enabled && !!params.advanced?.calibration?.historyByCity;\n  const [expertMode, setExpertMode] = useState(false);\n\n  const scopeValue =\n    scope.level === \"national\"\n      ? \"NATIONAL\"\n      : scope.level === \"state\"\n        ? `STATE:${scope.state}`\n        : `CITY:${scope.city}`;\n\n  const handleScopeChange = (val: string) => {\n    if (val === \"NATIONAL\") {\n      selectNational();\n    } else if (val.startsWith(\"STATE:\")) {\n      selectState(val.replace(\"STATE:\", \"\") as StateId);\n    } else if (val.startsWith(\"CITY:\")) {\n      selectCity(val.replace(\"CITY:\", \"\") as CityId);\n    }\n  };\n\n  const citiesWithState = includeAllCities ? CITIES : CITIES.filter((c) => c.isCapital);\n  const totalCitiesShown = citiesWithState.length;\n\n  return (\n    <div className=\"controls-panel\">\n      <div className=\"controls-header\">\n        <h2 className=\"h3\" style={{ margin: 0 }}>Scenario Controls</h2>\n        <button type=\"button\" className=\"btn-reset\" onClick={resetToDefaults}>\n           Reset\n        </button>\n      </div>\n\n      {/* Scenario & Scope */}\n      <ControlGroup title=\"Scenario & Scope\" icon=\"\" defaultOpen={true}>\n        <div className=\"field\">\n          <label className=\"field-label\">Policy Scenarios (multi-select)</label>\n          <div style={{ fontSize: 12, color: \"var(--muted)\", marginBottom: 8 }}>\n            Select multiple scenarios to stack their effects. Effects combine additively where applicable.\n          </div>\n          <div\n            style={{\n              display: \"flex\",\n              flexWrap: \"wrap\",\n              gap: 6,\n              padding: \"6px 8px\",\n              background: \"var(--bg-subtle)\",\n              borderRadius: 8,\n              marginBottom: 10,\n            }}\n            aria-label=\"Policy color key\"\n          >\n            <span style={{ fontSize: 11, fontWeight: 700, color: \"var(--muted)\", marginRight: 4 }}>\n              Color key:\n            </span>\n            {PARTY_ORDER.map((p) => (\n              <PartyChip key={p} party={p} />\n            ))}\n          </div>\n          <div style={{ display: \"flex\", flexDirection: \"column\", gap: 6 }}>\n            {/* Baseline */}\n            <label style={{ display: \"flex\", alignItems: \"center\", gap: 8, cursor: \"pointer\" }}>\n              <input\n                type=\"checkbox\"\n                checked={selectedPresets.includes(\"baseline\")}\n                onChange={() => togglePreset(\"baseline\")}\n                style={{ cursor: \"pointer\" }}\n              />\n              <span> Baseline (No Change)</span>\n            </label>\n\n            {/* Reforms */}\n            <div style={{ marginTop: 4, paddingLeft: 20, borderLeft: \"2px solid var(--border)\" }}>\n              <div style={{ fontSize: 11, fontWeight: 600, color: \"var(--muted)\", marginBottom: 6 }}>\n                Reforms\n              </div>\n              <label style={{ display: \"flex\", alignItems: \"center\", gap: 8, cursor: \"pointer\" }}>\n                <input\n                  type=\"checkbox\"\n                  checked={selectedPresets.includes(\"ng-remove\")}\n                  onChange={() => togglePreset(\"ng-remove\")}\n                  style={{ cursor: \"pointer\" }}\n                />\n                <span> Remove Negative Gearing</span>\n                {PRESET_PARTIES[\"ng-remove\"]?.map((p) => (\n                  <PartyChip key={`ng-remove-${p}`} party={p} />\n                ))}\n              </label>\n              <label style={{ display: \"flex\", alignItems: \"center\", gap: 8, cursor: \"pointer\" }}>\n                <input\n                  type=\"checkbox\"\n                  checked={selectedPresets.includes(\"ng-remove-fast\")}\n                  onChange={() => togglePreset(\"ng-remove-fast\")}\n                  style={{ cursor: \"pointer\" }}\n                />\n                <span> Remove NG (Immediate)</span>\n                {PRESET_PARTIES[\"ng-remove-fast\"]?.map((p) => (\n                  <PartyChip key={`ng-remove-fast-${p}`} party={p} />\n                ))}\n              </label>\n              <label style={{ display: \"flex\", alignItems: \"center\", gap: 8, cursor: \"pointer\" }}>\n                <input\n                  type=\"checkbox\"\n                  checked={selectedPresets.includes(\"ng-restore\")}\n                  onChange={() => togglePreset(\"ng-restore\")}\n                  style={{ cursor: \"pointer\" }}\n                />\n                <span> Restore Negative Gearing</span>\n                {PRESET_PARTIES[\"ng-restore\"]?.map((p) => (\n                  <PartyChip key={`ng-restore-${p}`} party={p} />\n                ))}\n              </label>\n              <label style={{ display: \"flex\", alignItems: \"center\", gap: 8, cursor: \"pointer\" }}>\n                <input\n                  type=\"checkbox\"\n                  checked={selectedPresets.includes(\"ownership-cap\")}\n                  onChange={() => togglePreset(\"ownership-cap\")}\n                  style={{ cursor: \"pointer\" }}\n                />\n                <span> Ownership Cap (1 PPOR + 1 IP)</span>\n                {PRESET_PARTIES[\"ownership-cap\"]?.map((p) => (\n                  <PartyChip key={`ownership-cap-${p}`} party={p} />\n                ))}\n              </label>\n              <label style={{ display: \"flex\", alignItems: \"center\", gap: 8, cursor: \"pointer\" }}>\n                <input\n                  type=\"checkbox\"\n                  checked={selectedPresets.includes(\"ownership-cap-aggressive\")}\n                  onChange={() => togglePreset(\"ownership-cap-aggressive\")}\n                  style={{ cursor: \"pointer\" }}\n                />\n                <span> Ownership Cap (Aggressive)</span>\n                {PRESET_PARTIES[\"ownership-cap-aggressive\"]?.map((p) => (\n                  <PartyChip key={`ownership-cap-aggressive-${p}`} party={p} />\n                ))}\n              </label>\n              <label style={{ display: \"flex\", alignItems: \"center\", gap: 8, cursor: \"pointer\" }}>\n                <input\n                  type=\"checkbox\"\n                  checked={selectedPresets.includes(\"supply-boost\")}\n                  onChange={() => togglePreset(\"supply-boost\")}\n                  style={{ cursor: \"pointer\" }}\n                />\n                <span> Supply Boost +20%</span>\n                {PRESET_PARTIES[\"supply-boost\"]?.map((p) => (\n                  <PartyChip key={`supply-boost-${p}`} party={p} />\n                ))}\n              </label>\n              <label style={{ display: \"flex\", alignItems: \"center\", gap: 8, cursor: \"pointer\" }}>\n                <input\n                  type=\"checkbox\"\n                  checked={selectedPresets.includes(\"comprehensive\")}\n                  onChange={() => togglePreset(\"comprehensive\")}\n                  style={{ cursor: \"pointer\" }}\n                />\n                <span> Comprehensive Reform</span>\n                {PRESET_PARTIES[\"comprehensive\"]?.map((p) => (\n                  <PartyChip key={`comprehensive-${p}`} party={p} />\n                ))}\n              </label>\n            </div>\n\n            {/* Expert presets */}\n            <div style={{ marginTop: 4, paddingLeft: 20, borderLeft: \"2px solid var(--border)\" }}>\n              <div style={{ fontSize: 11, fontWeight: 600, color: \"var(--muted)\", marginBottom: 6 }}>\n                Expert Presets\n              </div>\n              <label style={{ display: \"flex\", alignItems: \"center\", gap: 8, cursor: \"pointer\" }}>\n                <input\n                  type=\"checkbox\"\n                  checked={selectedPresets.includes(\"land-tax-transition\")}\n                  onChange={() => togglePreset(\"land-tax-transition\")}\n                  style={{ cursor: \"pointer\" }}\n                />\n                <span> Land Tax Transition</span>\n                {PRESET_PARTIES[\"land-tax-transition\"]?.map((p) => (\n                  <PartyChip key={`land-tax-transition-${p}`} party={p} />\n                ))}\n              </label>\n              <label style={{ display: \"flex\", alignItems: \"center\", gap: 8, cursor: \"pointer\" }}>\n                <input\n                  type=\"checkbox\"\n                  checked={selectedPresets.includes(\"macroprudential-tightening\")}\n                  onChange={() => togglePreset(\"macroprudential-tightening\")}\n                  style={{ cursor: \"pointer\" }}\n                />\n                <span> Macroprudential Tightening</span>\n                {PRESET_PARTIES[\"macroprudential-tightening\"]?.map((p) => (\n                  <PartyChip key={`macroprudential-tightening-${p}`} party={p} />\n                ))}\n              </label>\n              <label style={{ display: \"flex\", alignItems: \"center\", gap: 8, cursor: \"pointer\" }}>\n                <input\n                  type=\"checkbox\"\n                  checked={selectedPresets.includes(\"short-stay-clampdown\")}\n                  onChange={() => togglePreset(\"short-stay-clampdown\")}\n                  style={{ cursor: \"pointer\" }}\n                />\n                <span> Short-Stay Clampdown</span>\n                {PRESET_PARTIES[\"short-stay-clampdown\"]?.map((p) => (\n                  <PartyChip key={`short-stay-clampdown-${p}`} party={p} />\n                ))}\n              </label>\n              <label style={{ display: \"flex\", alignItems: \"center\", gap: 8, cursor: \"pointer\" }}>\n                <input\n                  type=\"checkbox\"\n                  checked={selectedPresets.includes(\"public-housing-build\")}\n                  onChange={() => togglePreset(\"public-housing-build\")}\n                  style={{ cursor: \"pointer\" }}\n                />\n                <span> Public Housing Build</span>\n                {PRESET_PARTIES[\"public-housing-build\"]?.map((p) => (\n                  <PartyChip key={`public-housing-build-${p}`} party={p} />\n                ))}\n              </label>\n              <label style={{ display: \"flex\", alignItems: \"center\", gap: 8, cursor: \"pointer\" }}>\n                <input\n                  type=\"checkbox\"\n                  checked={selectedPresets.includes(\"migration-shock-down\")}\n                  onChange={() => togglePreset(\"migration-shock-down\")}\n                  style={{ cursor: \"pointer\" }}\n                />\n                <span> Migration Shock (Lower)</span>\n                {PRESET_PARTIES[\"migration-shock-down\"]?.map((p) => (\n                  <PartyChip key={`migration-shock-down-${p}`} party={p} />\n                ))}\n              </label>\n              <label style={{ display: \"flex\", alignItems: \"center\", gap: 8, cursor: \"pointer\" }}>\n                <input\n                  type=\"checkbox\"\n                  checked={selectedPresets.includes(\"all-levers\")}\n                  onChange={() => togglePreset(\"all-levers\")}\n                  style={{ cursor: \"pointer\" }}\n                />\n                <span> All Levers (Stress Test)</span>\n                {PRESET_PARTIES[\"all-levers\"]?.map((p) => (\n                  <PartyChip key={`all-levers-${p}`} party={p} />\n                ))}\n              </label>\n            </div>\n\n            {selectedPresets.length > 1 && (\n              <div style={{ marginTop: 8, padding: 8, background: \"var(--accent-light)\", borderRadius: 6, fontSize: 11 }}>\n                <strong>Stacking {selectedPresets.length} scenarios:</strong> Effects combine additively (supply/demand) or use maximum (restrictions).\n              </div>\n            )}\n          </div>\n        </div>\n\n        <div className=\"field\">\n          <label className=\"field-label\">Model engine</label>\n          <select\n            value={engine ?? \"aggregate\"}\n            onChange={(e) => setEngine(e.target.value as any)}\n            className=\"select-field\"\n          >\n            <option value=\"aggregate\"> Aggregate (fast)</option>\n            <option value=\"advanced\"> Advanced (spatial + portfolio)</option>\n          </select>\n          <div className=\"muted\" style={{ fontSize: 12, marginTop: 4 }}>\n            Advanced mode couples cities via migration (spatial equilibrium) and adds heterogeneous expectations +\n            investor portfolio allocation. Microdata (if provided) can replace the decile proxy for stress rates.\n          </div>\n        </div>\n\n        <div className=\"field\">\n          <label className=\"field-label\">Geographic view</label>\n          <select\n            value={scopeValue}\n            onChange={(e) => handleScopeChange(e.target.value)}\n            className=\"select-field\"\n          >\n            <option value=\"NATIONAL\"> National</option>\n            <optgroup label=\"States\">\n              {ALL_STATES.map((st) => (\n                <option key={st} value={`STATE:${st}`}>\n                  {STATE_NAMES[st]}\n                </option>\n              ))}\n            </optgroup>\n            <optgroup label=\"Cities\">\n              {citiesWithState.map((c) => (\n                <option key={c.id} value={`CITY:${c.id}`}>\n                  {c.name}\n                </option>\n              ))}\n            </optgroup>\n          </select>\n        </div>\n\n        <label className=\"checkbox-field\">\n          <input\n            type=\"checkbox\"\n            checked={includeAllCities}\n            onChange={(e) => toggleCityCoverage(e.target.checked)}\n          />\n          <span>Include regional cities ({totalCitiesShown} total)</span>\n        </label>\n\n        <SliderField\n          label=\"Years\"\n          value={params.years}\n          min={5}\n          max={30}\n          step={1}\n          onChange={setYears}\n          tooltip={HELP.horizon.tooltip}\n        />\n\n        <div className=\"field\" style={{ marginTop: 10 }}>\n          <label className=\"field-label\">Timeline</label>\n          <label className=\"checkbox-field\" style={{ marginTop: 6 }}>\n            <input\n              type=\"checkbox\"\n              checked={showHistory}\n              onChange={(e) => setShowHistory(e.target.checked)}\n            />\n            <span>Show historical overlay (2000  present)</span>\n          </label>\n          <div className=\"muted\" style={{ fontSize: 12, marginTop: 4 }}>\n            Historical lines appear muted. Projections begin at the city baseline year.\n          </div>\n          <div style={{ display: \"flex\", gap: 8, marginTop: 8, alignItems: \"center\" }}>\n            <span className=\"muted\" style={{ fontSize: 12 }}>Index base:</span>\n            <select\n              value={historyIndexBase}\n              onChange={(e) => setHistoryIndexBase(e.target.value as any)}\n              className=\"select-field\"\n              style={{ maxWidth: 220 }}\n            >\n              <option value=\"history\">Year 2000 (or earliest available)</option>\n              <option value=\"year0\">Baseline year (model start)</option>\n            </select>\n          </div>\n        </div>\n\n        <div className=\"field\" style={{ marginTop: 14 }}>\n          <label className=\"field-label\">RBA policy path</label>\n          <label className=\"checkbox-field\" style={{ marginTop: 6 }}>\n            <input\n              type=\"checkbox\"\n              checked={autoRba}\n              onChange={(e) => setAutoRba(e.target.checked)}\n            />\n            <span>Autoselect RBA response</span>\n          </label>\n          {autoRba && (\n            <div className=\"muted\" style={{ fontSize: 12, marginTop: 4 }}>\n              {autoRbaMessage}\n            </div>\n          )}\n          <div style={{ display: \"grid\", gap: 6, marginTop: 8 }}>\n            <select\n              value={ratePath.mode ?? \"scenario\"}\n              onChange={(e) =>\n                setRatePath({\n                  ...ratePath,\n                  mode: e.target.value as any,\n                })\n              }\n              className=\"select-field\"\n              disabled={autoRba}\n            >\n              <option value=\"scenario\">Scenario</option>\n              <option value=\"fixed\">Fixed</option>\n              <option value=\"rule\">RBA rule (simple)</option>\n            </select>\n            {ratePath.mode === \"scenario\" && (\n              <select\n                value={ratePath.scenario ?? \"steady\"}\n                onChange={(e) =>\n                  setRatePath({\n                    ...ratePath,\n                    scenario: e.target.value as any,\n                  })\n                }\n                className=\"select-field\"\n                disabled={autoRba}\n              >\n                <option value=\"steady\">Steady</option>\n                <option value=\"tighten\">Tighten</option>\n                <option value=\"ease\">Ease</option>\n                <option value=\"highForLonger\">High for longer</option>\n                <option value=\"cutThenNormalize\">Cut then normalize</option>\n              </select>\n            )}\n          </div>\n          <div className=\"muted\" style={{ fontSize: 12, marginTop: 6 }}>\n            Base rate is aligned to the latest RBA cash rate if provided in historical data; otherwise it uses the city baseline mortgage rate.\n          </div>\n        </div>\n      </ControlGroup>\n\n      {/* Negative Gearing */}\n      <ControlGroup title=\"Negative Gearing\" icon=\"\" defaultOpen={true} tone=\"warning\">\n        <div style={{ display: \"flex\", gap: 6, flexWrap: \"wrap\", marginBottom: 8 }}>\n          {GROUP_PARTIES[\"Negative Gearing\"].map((p) => (\n            <PartyChip key={`ng-${p}`} party={p} />\n          ))}\n        </div>\n        <div className=\"field\">\n          <select\n            value={params.policy.negativeGearingMode}\n            onChange={(e) =>\n              patchPolicy({ negativeGearingMode: e.target.value as NegativeGearingMode })\n            }\n            className=\"select-field\"\n          >\n            <option value=\"none\">No change</option>\n            <option value=\"remove\">Remove / phase out</option>\n            <option value=\"reverse\">Restore</option>\n          </select>\n        </div>\n\n        {params.policy.negativeGearingMode !== \"none\" && (\n          <SliderField\n            label=\"Intensity\"\n            value={params.policy.negativeGearingIntensity * 100}\n            min={0}\n            max={100}\n            step={10}\n            onChange={(v) => patchPolicy({ negativeGearingIntensity: v / 100 })}\n            format={(v) => `${v}%`}\n            tooltip={HELP.negativeGearing.intensity.tooltip}\n          />\n        )}\n      </ControlGroup>\n\n      {/* Ownership Cap */}\n      <ControlGroup title=\"Ownership Cap\" icon=\"\" defaultOpen={true} tone=\"success\">\n        <div style={{ display: \"flex\", gap: 6, flexWrap: \"wrap\", marginBottom: 8 }}>\n          {GROUP_PARTIES[\"Ownership Cap\"].map((p) => (\n            <PartyChip key={`oc-${p}`} party={p} />\n          ))}\n        </div>\n        <label className=\"checkbox-field\">\n          <input\n            type=\"checkbox\"\n            checked={params.policy.ownershipCapEnabled}\n            onChange={(e) => patchPolicy({ ownershipCapEnabled: e.target.checked })}\n          />\n          <span>Enable cap (1 PPOR + 1 IP)</span>\n        </label>\n\n        {params.policy.ownershipCapEnabled && (\n          <>\n            <SliderField\n              label=\"Enforcement\"\n              value={params.policy.ownershipCapEnforcement * 100}\n              min={0}\n              max={100}\n              step={10}\n              onChange={(v) => patchPolicy({ ownershipCapEnforcement: v / 100 })}\n              format={(v) => `${v}%`}\n              tooltip={HELP.ownershipCap.enforcement.tooltip}\n            />\n            <SliderField\n              label=\"Excess stock\"\n              value={params.policy.excessInvestorStockShare * 100}\n              min={0}\n              max={40}\n              step={5}\n              onChange={(v) => patchPolicy({ excessInvestorStockShare: v / 100 })}\n              format={(v) => `${v}%`}\n              tooltip={HELP.ownershipCap.excessStock.tooltip}\n            />\n            <label className=\"checkbox-field\">\n              <input\n                type=\"checkbox\"\n                checked={params.policy.divestmentPhased}\n                onChange={(e) => patchPolicy({ divestmentPhased: e.target.checked })}\n              />\n              <span>Phased divestment</span>\n            </label>\n          </>\n        )}\n      </ControlGroup>\n\n      {/* Supply & Demand */}\n      <ControlGroup title=\"Supply & Demand\" icon=\"\" defaultOpen={false}>\n        <div style={{ display: \"flex\", gap: 6, flexWrap: \"wrap\", marginBottom: 8 }}>\n          {GROUP_PARTIES[\"Supply & Demand\"].map((p) => (\n            <PartyChip key={`sd-${p}`} party={p} />\n          ))}\n        </div>\n        <SliderField\n          label=\"Supply boost (10% to +25%)\"\n          value={params.policy.supplyBoost * 100}\n          min={-10}\n          max={25}\n          step={2.5}\n          onChange={(v) => patchPolicy({ supplyBoost: v / 100 })}\n          format={fmtPctPoints}\n          tooltip={HELP.supplyBoost.tooltip}\n        />\n        <SliderField\n          label=\"Demand reduction (5% to +15%)\"\n          value={params.policy.demandReduction * 100}\n          min={-5}\n          max={15}\n          step={2.5}\n          onChange={(v) => patchPolicy({ demandReduction: v / 100 })}\n          format={fmtPctPoints}\n          tooltip={HELP.demandReduction.tooltip}\n        />\n      </ControlGroup>\n\n      {/* Expert Mode */}\n      <ControlGroup title=\"Expert mode (calibration-first)\" icon=\"\" defaultOpen={false} tone=\"info\">\n        <label className=\"checkbox-field\" style={{ marginBottom: 8 }}>\n          <input type=\"checkbox\" checked={expertMode} onChange={(e) => setExpertMode(e.target.checked)} />\n          <span>Show advanced policy levers</span>\n        </label>\n\n        <div className=\"muted\" style={{ fontSize: 12, lineHeight: 1.45, marginBottom: 10 }}>\n          These levers run without calibration, but should be treated as directional unless you supply historical series\n          (affordability ratios) to the calibrator.{\" \"}\n          {calibrationEnabled ? (\n            <StatusChip tone=\"success\" text=\"Calibration data detected\" />\n          ) : (\n            <StatusChip tone=\"warning\" text=\"No calibration data\" />\n          )}\n        </div>\n\n        {expertMode && (\n          <>\n            <div style={{ display: \"flex\", alignItems: \"center\", gap: 8, margin: \"10px 0 6px\" }}>\n              <div style={{ fontWeight: 800 }}>Tax & investor incentives</div>\n              {GROUP_PARTIES[\"Tax & investor incentives\"].map((p) => (\n                <PartyChip key={`tax-${p}`} party={p} />\n              ))}\n            </div>\n            <SliderField\n              label=\"CGT discount change (25pp to +25pp)\"\n              value={policy.taxInvestor.cgtDiscountDelta * 100}\n              min={-25}\n              max={25}\n              step={5}\n              onChange={(pp) =>\n                patchPolicy({ taxInvestor: { ...policy.taxInvestor, cgtDiscountDelta: pp / 100 } } as any)\n              }\n              format={fmtPctPoints}\n              tooltip={HELP.expert?.cgtDiscountDelta?.tooltip}\n            />\n            <SliderField\n              label=\"Stamp duty  land tax shift (0% to 100%)\"\n              value={policy.taxInvestor.landTaxShift * 100}\n              min={0}\n              max={100}\n              step={10}\n              onChange={(pct) => patchPolicy({ taxInvestor: { ...policy.taxInvestor, landTaxShift: pct / 100 } } as any)}\n              format={fmtPctPoints}\n              tooltip={HELP.expert?.landTaxShift?.tooltip}\n            />\n            <SliderField\n              label=\"Vacancy tax intensity (0% to 100%)\"\n              value={policy.taxInvestor.vacancyTaxIntensity * 100}\n              min={0}\n              max={100}\n              step={10}\n              onChange={(pct) =>\n                patchPolicy({ taxInvestor: { ...policy.taxInvestor, vacancyTaxIntensity: pct / 100 } } as any)\n              }\n              format={fmtPctPoints}\n              tooltip={HELP.expert?.vacancyTaxIntensity?.tooltip}\n            />\n            <SliderField\n              label=\"Short-stay regulation intensity (0% to 100%)\"\n              value={policy.taxInvestor.shortStayRegulationIntensity * 100}\n              min={0}\n              max={100}\n              step={10}\n              onChange={(pct) =>\n                patchPolicy({\n                  taxInvestor: { ...policy.taxInvestor, shortStayRegulationIntensity: pct / 100 },\n                } as any)\n              }\n              format={fmtPctPoints}\n              tooltip={HELP.expert?.shortStayRegulationIntensity?.tooltip}\n            />\n            <SliderField\n              label=\"Foreign buyer restriction intensity (0% to 100%)\"\n              value={policy.taxInvestor.foreignBuyerRestrictionIntensity * 100}\n              min={0}\n              max={100}\n              step={10}\n              onChange={(pct) =>\n                patchPolicy({\n                  taxInvestor: { ...policy.taxInvestor, foreignBuyerRestrictionIntensity: pct / 100 },\n                } as any)\n              }\n              format={fmtPctPoints}\n              tooltip={HELP.expert?.foreignBuyerRestrictionIntensity?.tooltip}\n            />\n\n            <div style={{ display: \"flex\", alignItems: \"center\", gap: 8, margin: \"14px 0 6px\" }}>\n              <div style={{ fontWeight: 800 }}>Credit / macro-prudential</div>\n              {GROUP_PARTIES[\"Credit / macro-prudential\"].map((p) => (\n                <PartyChip key={`credit-${p}`} party={p} />\n              ))}\n            </div>\n            <SliderField\n              label=\"Serviceability buffer delta (2pp to +3pp)\"\n              value={policy.credit.serviceabilityBufferDelta * 100}\n              min={-2}\n              max={3}\n              step={0.5}\n              onChange={(pp) =>\n                patchPolicy({ credit: { ...policy.credit, serviceabilityBufferDelta: pp / 100 } } as any)\n              }\n              format={fmtPctPoints}\n              tooltip={HELP.expert?.serviceabilityBufferDelta?.tooltip}\n            />\n            <SliderField\n              label=\"DTI cap tightness (0% to 100%)\"\n              value={policy.credit.dtiCapTightness * 100}\n              min={0}\n              max={100}\n              step={10}\n              onChange={(pct) => patchPolicy({ credit: { ...policy.credit, dtiCapTightness: pct / 100 } } as any)}\n              format={fmtPctPoints}\n              tooltip={HELP.expert?.dtiCapTightness?.tooltip}\n            />\n            <SliderField\n              label=\"Investor lending limit tightness (0% to 100%)\"\n              value={policy.credit.investorLendingLimitTightness * 100}\n              min={0}\n              max={100}\n              step={10}\n              onChange={(pct) =>\n                patchPolicy({ credit: { ...policy.credit, investorLendingLimitTightness: pct / 100 } } as any)\n              }\n              format={fmtPctPoints}\n              tooltip={HELP.expert?.investorLendingLimitTightness?.tooltip}\n            />\n\n            <div style={{ display: \"flex\", alignItems: \"center\", gap: 8, margin: \"14px 0 6px\" }}>\n              <div style={{ fontWeight: 800 }}>Demand-side subsidies</div>\n              {GROUP_PARTIES[\"Demand-side subsidies\"].map((p) => (\n                <PartyChip key={`subsidies-${p}`} party={p} />\n              ))}\n            </div>\n            <SliderField\n              label=\"First-home buyer subsidy intensity (0% to 100%)\"\n              value={policy.subsidies.firstHomeBuyerSubsidyIntensity * 100}\n              min={0}\n              max={100}\n              step={10}\n              onChange={(pct) =>\n                patchPolicy({\n                  subsidies: { ...policy.subsidies, firstHomeBuyerSubsidyIntensity: pct / 100 },\n                } as any)\n              }\n              format={fmtPctPoints}\n              tooltip={HELP.expert?.firstHomeBuyerSubsidyIntensity?.tooltip}\n            />\n\n            <div style={{ display: \"flex\", alignItems: \"center\", gap: 8, margin: \"14px 0 6px\" }}>\n              <div style={{ fontWeight: 800 }}>Rental settings</div>\n              {GROUP_PARTIES[\"Rental settings\"].map((p) => (\n                <PartyChip key={`rental-${p}`} party={p} />\n              ))}\n            </div>\n            <SliderField\n              label=\"Rent assistance intensity (0% to 100%)\"\n              value={policy.rental.rentAssistanceIntensity * 100}\n              min={0}\n              max={100}\n              step={10}\n              onChange={(pct) =>\n                patchPolicy({ rental: { ...policy.rental, rentAssistanceIntensity: pct / 100 } } as any)\n              }\n              format={fmtPctPoints}\n              tooltip={HELP.expert?.rentAssistanceIntensity?.tooltip}\n            />\n            <label className=\"checkbox-field\" style={{ marginTop: 6 }}>\n              <input\n                type=\"checkbox\"\n                checked={policy.rental.rentRegulationCap != null}\n                onChange={(e) =>\n                  patchPolicy({\n                    rental: { ...policy.rental, rentRegulationCap: e.target.checked ? 0.03 : null },\n                  } as any)\n                }\n              />\n              <span>Enable rent growth cap</span>\n            </label>\n            {policy.rental.rentRegulationCap != null && (\n              <SliderField\n                label=\"Rent growth cap (0% to 8% nominal/yr)\"\n                value={policy.rental.rentRegulationCap * 100}\n                min={0}\n                max={8}\n                step={0.5}\n                onChange={(pp) => patchPolicy({ rental: { ...policy.rental, rentRegulationCap: pp / 100 } } as any)}\n                format={fmtPctPoints}\n                tooltip={HELP.expert?.rentRegulationCap?.tooltip}\n              />\n            )}\n            <SliderField\n              label=\"Rent regulation coverage (0% to 100%)\"\n              value={policy.rental.rentRegulationCoverage * 100}\n              min={0}\n              max={100}\n              step={10}\n              onChange={(pct) =>\n                patchPolicy({ rental: { ...policy.rental, rentRegulationCoverage: pct / 100 } } as any)\n              }\n              format={fmtPctPoints}\n              tooltip={HELP.expert?.rentRegulationCoverage?.tooltip}\n            />\n            <label className=\"checkbox-field\">\n              <input\n                type=\"checkbox\"\n                checked={policy.rental.vacancyDecontrol}\n                onChange={(e) => patchPolicy({ rental: { ...policy.rental, vacancyDecontrol: e.target.checked } } as any)}\n              />\n              <span>Vacancy decontrol (caps dont bind on turnover)</span>\n            </label>\n\n            <div style={{ display: \"flex\", alignItems: \"center\", gap: 8, margin: \"14px 0 6px\" }}>\n              <div style={{ fontWeight: 800 }}>Planning / infrastructure</div>\n              {GROUP_PARTIES[\"Planning / infrastructure\"].map((p) => (\n                <PartyChip key={`planning-${p}`} party={p} />\n              ))}\n            </div>\n            <SliderField\n              label=\"Upzoning intensity (0% to 100%)\"\n              value={policy.planning.upzoningIntensity * 100}\n              min={0}\n              max={100}\n              step={10}\n              onChange={(pct) => patchPolicy({ planning: { ...policy.planning, upzoningIntensity: pct / 100 } } as any)}\n              format={fmtPctPoints}\n              tooltip={HELP.expert?.upzoningIntensity?.tooltip}\n            />\n            <SliderField\n              label=\"Infrastructure enablement (0% to 100%)\"\n              value={policy.planning.infrastructureEnablement * 100}\n              min={0}\n              max={100}\n              step={10}\n              onChange={(pct) =>\n                patchPolicy({\n                  planning: { ...policy.planning, infrastructureEnablement: pct / 100 },\n                } as any)\n              }\n              format={fmtPctPoints}\n              tooltip={HELP.expert?.infrastructureEnablement?.tooltip}\n            />\n            <SliderField\n              label=\"Infrastructure lag (0 to 10 years)\"\n              value={policy.planning.infrastructureLagYears}\n              min={0}\n              max={10}\n              step={1}\n              onChange={(v) =>\n                patchPolicy({ planning: { ...policy.planning, infrastructureLagYears: v } } as any)\n              }\n              tooltip={HELP.expert?.infrastructureLagYears?.tooltip}\n            />\n\n            <div style={{ display: \"flex\", alignItems: \"center\", gap: 8, margin: \"14px 0 6px\" }}>\n              <div style={{ fontWeight: 800 }}>Public & community housing</div>\n              {GROUP_PARTIES[\"Public & community housing\"].map((p) => (\n                <PartyChip key={`public-${p}`} party={p} />\n              ))}\n            </div>\n            <SliderField\n              label=\"Public housing build boost (0% to 20%)\"\n              value={policy.publicCommunity.publicHousingBuildBoost * 100}\n              min={0}\n              max={20}\n              step={2}\n              onChange={(pp) =>\n                patchPolicy({\n                  publicCommunity: { ...policy.publicCommunity, publicHousingBuildBoost: pp / 100 },\n                } as any)\n              }\n              format={fmtPctPoints}\n              tooltip={HELP.expert?.publicHousingBuildBoost?.tooltip}\n            />\n            <SliderField\n              label=\"Public acquisition share (0% to 1% of stock/yr)\"\n              value={policy.publicCommunity.publicHousingAcquisitionSharePerYear * 100}\n              min={0}\n              max={1}\n              step={0.1}\n              onChange={(pp) =>\n                patchPolicy({\n                  publicCommunity: {\n                    ...policy.publicCommunity,\n                    publicHousingAcquisitionSharePerYear: pp / 100,\n                  },\n                } as any)\n              }\n              format={fmtPctPoints}\n              tooltip={HELP.expert?.publicHousingAcquisitionSharePerYear?.tooltip}\n            />\n            <SliderField\n              label=\"Private  social conversion (0% to 1% of stock/yr)\"\n              value={policy.publicCommunity.conversionToSocialSharePerYear * 100}\n              min={0}\n              max={1}\n              step={0.1}\n              onChange={(pp) =>\n                patchPolicy({\n                  publicCommunity: { ...policy.publicCommunity, conversionToSocialSharePerYear: pp / 100 },\n                } as any)\n              }\n              format={fmtPctPoints}\n              tooltip={HELP.expert?.conversionToSocialSharePerYear?.tooltip}\n            />\n\n            <div style={{ display: \"flex\", alignItems: \"center\", gap: 8, margin: \"14px 0 6px\" }}>\n              <div style={{ fontWeight: 800 }}>Population</div>\n              {GROUP_PARTIES[\"Population\"].map((p) => (\n                <PartyChip key={`pop-${p}`} party={p} />\n              ))}\n            </div>\n            <SliderField\n              label=\"Net overseas migration shock (30% to +30%)\"\n              value={policy.migration.netOverseasMigrationShock * 100}\n              min={-30}\n              max={30}\n              step={5}\n              onChange={(pp) =>\n                patchPolicy({ migration: { ...policy.migration, netOverseasMigrationShock: pp / 100 } } as any)\n              }\n              format={fmtPctPoints}\n              tooltip={HELP.expert?.netOverseasMigrationShock?.tooltip}\n            />\n\n            <div className=\"muted\" style={{ fontSize: 12, marginTop: 10 }}>\n              Tip: you can still use presets above, then finetune these sublevers for sensitivity testing.\n            </div>\n          </>\n        )}\n      </ControlGroup>\n\n      {/* Timing */}\n      <ControlGroup title=\"Policy Timing\" icon=\"\" defaultOpen={false}>\n        <SliderField\n          label=\"Ramp period\"\n          value={params.policy.rampYears}\n          min={0}\n          max={10}\n          step={1}\n          onChange={(v) => patchPolicy({ rampYears: v })}\n          format={(v) => `${v} years`}\n          tooltip={HELP.ramp.tooltip}\n        />\n      </ControlGroup>\n    </div>\n  );\n}\n","import type { CityBaseState, CoreConstants, Year } from \"../methodology\";\nimport type { CityId, Scope, StateId } from \"../regions\";\nimport type { RegionScenarioOutputs, RegionYearState, ScenarioOutputs } from \"../runScenario\";\nimport { computeStampDutyRevenue } from \"../methodology\";\nimport { cityMeta, scopeKey } from \"../regions\";\nimport type { HistoryBundle, TimelinePoint } from \"./types\";\n\nfunction clamp(x: number, lo: number, hi: number): number {\n  return Math.max(lo, Math.min(hi, x));\n}\n\nfunction pickBaseYear(opts: {\n  indexBase: \"history\" | \"year0\";\n  history?: TimelinePoint[];\n  projected?: RegionYearState[];\n  year0: Year;\n}): Year {\n  if (opts.indexBase === \"year0\") return opts.year0;\n  const h0 = opts.history?.[0]?.year;\n  if (h0 != null) return h0 as Year;\n  const p0 = opts.projected?.[0]?.year;\n  return (p0 ?? opts.year0) as Year;\n}\n\nfunction valueAtYear(points: Array<{ year: Year; value?: number }>, year: Year): number | null {\n  const p = points.find((x) => x.year === year);\n  return typeof p?.value === \"number\" && Number.isFinite(p.value) ? p.value : null;\n}\n\nfunction toTimelineHistoricalCity(opts: {\n  city: CityBaseState;\n  history: HistoryBundle;\n  c: CoreConstants;\n  stampDutyRate: number;\n}): TimelinePoint[] {\n  const s = opts.history.byCity[opts.city.cityId];\n  if (!s) return [];\n  const n = s.years.length;\n  const out: TimelinePoint[] = [];\n  for (let i = 0; i < n; i++) {\n    const medianPrice = s.medianPrice?.[i] ?? null;\n    const dwellingStock = s.dwellingStock?.[i] ?? null;\n    const stampDutyRevenue =\n      typeof medianPrice === \"number\" && typeof dwellingStock === \"number\"\n        ? computeStampDutyRevenue({\n            medianPrice,\n            dwellingStock,\n            annualTurnoverRate: opts.c.annualTurnoverRate,\n            stampDutyRate: opts.stampDutyRate,\n          })\n        : undefined;\n    out.push({\n      year: s.years[i],\n      kind: \"historical\",\n      medianPrice: typeof medianPrice === \"number\" ? medianPrice : undefined,\n      medianAnnualRent:\n        typeof s.medianAnnualRent?.[i] === \"number\" ? (s.medianAnnualRent[i] as number) : undefined,\n      medianAnnualWage:\n        typeof s.medianAnnualWage?.[i] === \"number\" ? (s.medianAnnualWage[i] as number) : undefined,\n      population: typeof s.population?.[i] === \"number\" ? (s.population[i] as number) : undefined,\n      dwellingStock: typeof dwellingStock === \"number\" ? dwellingStock : undefined,\n      stampDutyRevenue,\n    });\n  }\n  return out;\n}\n\nfunction aggregateHistorical(opts: {\n  scope: Scope;\n  cities: CityBaseState[];\n  history: HistoryBundle;\n  c: CoreConstants;\n  stampDutyRate: number;\n}): TimelinePoint[] {\n  const included = (() => {\n    if (opts.scope.level === \"national\") return opts.cities;\n    if (opts.scope.level === \"city\") {\n      const cityScope = opts.scope as { level: \"city\"; city: CityId };\n      return opts.cities.filter((c) => c.cityId === cityScope.city);\n    }\n    // opts.scope.level === \"state\"\n    const stateScope = opts.scope as { level: \"state\"; state: StateId };\n    return opts.cities.filter((c) => cityMeta(c.cityId).state === stateScope.state);\n  })();\n\n  if (included.length === 0) return [];\n\n  const years = opts.history.startYear <= opts.history.endYear\n    ? (Array.from({ length: opts.history.endYear - opts.history.startYear + 1 }, (_, i) => (opts.history.startYear + i) as Year))\n    : [];\n\n  // Weight by population where available; fallback to baseline city population weights.\n  const fallbackPop: Record<CityId, number> = {} as any;\n  included.forEach((c) => (fallbackPop[c.cityId] = c.population));\n\n  const out: TimelinePoint[] = [];\n  years.forEach((y) => {\n    const parts = included.map((c) => {\n      const s = opts.history.byCity[c.cityId];\n      if (!s) return null;\n      const idx = s.years.indexOf(y);\n      if (idx < 0) return null;\n      return {\n        cityId: c.cityId,\n        medianPrice: s.medianPrice?.[idx] ?? null,\n        medianAnnualRent: s.medianAnnualRent?.[idx] ?? null,\n        medianAnnualWage: s.medianAnnualWage?.[idx] ?? null,\n        population: s.population?.[idx] ?? null,\n        dwellingStock: s.dwellingStock?.[idx] ?? null,\n      };\n    }).filter(Boolean) as Array<{\n      cityId: CityId;\n      medianPrice: number | null;\n      medianAnnualRent: number | null;\n      medianAnnualWage: number | null;\n      population: number | null;\n      dwellingStock: number | null;\n    }>;\n\n    if (parts.length === 0) return;\n\n    const popWeights = parts.map((p) => (typeof p.population === \"number\" ? p.population : fallbackPop[p.cityId] ?? 0));\n    const wSum = popWeights.reduce((a, b) => a + b, 0) || 1;\n    const w = popWeights.map((x) => x / wSum);\n\n    const wAvg = (xs: Array<number | null>): number | undefined => {\n      let s = 0;\n      let ws = 0;\n      xs.forEach((v, i) => {\n        if (typeof v === \"number\" && Number.isFinite(v)) {\n          s += w[i] * v;\n          ws += w[i];\n        }\n      });\n      if (ws <= 0) return undefined;\n      return s / ws;\n    };\n\n    const pop = wAvg(parts.map((p) => p.population)) ?? popWeights.reduce((a, b) => a + b, 0);\n    const stock = wAvg(parts.map((p) => p.dwellingStock));\n    const price = wAvg(parts.map((p) => p.medianPrice));\n    const rent = wAvg(parts.map((p) => p.medianAnnualRent));\n    const wage = wAvg(parts.map((p) => p.medianAnnualWage));\n\n    const stampDutyRevenue =\n      typeof price === \"number\" && typeof stock === \"number\"\n        ? computeStampDutyRevenue({\n            medianPrice: price,\n            dwellingStock: stock,\n            annualTurnoverRate: opts.c.annualTurnoverRate,\n            stampDutyRate: opts.stampDutyRate,\n          })\n        : undefined;\n\n    out.push({\n      year: y,\n      kind: \"historical\",\n      population: pop,\n      dwellingStock: stock,\n      medianPrice: price,\n      medianAnnualRent: rent,\n      medianAnnualWage: wage,\n      stampDutyRevenue,\n    });\n  });\n\n  return out;\n}\n\nexport function buildRegionTimeline(opts: {\n  outputs: ScenarioOutputs;\n  scope: Scope;\n  historyBundle?: HistoryBundle;\n  cities: CityBaseState[];\n  c: CoreConstants;\n  stampDutyRate: number;\n  year0: Year;\n  indexBase: \"history\" | \"year0\";\n}): {\n  id: string;\n  scope: Scope;\n  cutoverYear: Year;\n  timeline: TimelinePoint[];\n  meta: { notes: string[]; warnings: string[]; historyAvailable: boolean };\n} {\n  const region = opts.outputs.byRegion[scopeKey(opts.scope)];\n  const projected = region?.years ?? [];\n  const historyAvailable = !!opts.historyBundle;\n\n  const history = opts.historyBundle\n    ? aggregateHistorical({\n        scope: opts.scope,\n        cities: opts.cities,\n        history: opts.historyBundle,\n        c: opts.c,\n        stampDutyRate: opts.stampDutyRate,\n      })\n    : [];\n\n  const baseYear = pickBaseYear({\n    indexBase: opts.indexBase,\n    history,\n    projected,\n    year0: opts.year0,\n  });\n\n  const basePrice = valueAtYear(\n    (history.length ? history : projected).map((p: any) => ({ year: p.year, value: p.medianPrice })),\n    baseYear\n  );\n  const baseRent = valueAtYear(\n    (history.length ? history : projected).map((p: any) => ({ year: p.year, value: p.medianAnnualRent })),\n    baseYear\n  );\n  const baseWage = valueAtYear(\n    (history.length ? history : projected).map((p: any) => ({ year: p.year, value: p.medianAnnualWage })),\n    baseYear\n  );\n\n  const idx = (v?: number, base?: number | null) =>\n    typeof v === \"number\" && typeof base === \"number\" && base > 0 ? (v / base) * 100 : undefined;\n\n  const historicalWithIndex: TimelinePoint[] = history.map((p) => ({\n    ...p,\n    priceIndex: idx(p.medianPrice, basePrice),\n    rentIndex: idx(p.medianAnnualRent, baseRent),\n    wageIndex: idx(p.medianAnnualWage, baseWage),\n  }));\n\n  const projectedWithKind: TimelinePoint[] = projected.map((p) => ({\n    year: p.year,\n    kind: \"projected\",\n    population: p.population,\n    dwellingStock: p.dwellingStock,\n    medianPrice: p.medianPrice,\n    medianAnnualRent: p.medianAnnualRent,\n    medianAnnualWage: p.medianAnnualWage,\n    stampDutyRevenue: p.stampDutyRevenue,\n    priceIndex: idx(p.medianPrice, basePrice),\n    rentIndex: idx(p.medianAnnualRent, baseRent),\n    wageIndex: idx(p.medianAnnualWage, baseWage),\n  }));\n\n  // Join, avoiding duplicate year0 if history ends at year0.\n  const cutoverYear = opts.year0;\n  const histYears = new Set(historicalWithIndex.map((p) => p.year));\n  const joined = [\n    ...historicalWithIndex,\n    ...projectedWithKind.filter((p) => !histYears.has(p.year)),\n  ].sort((a, b) => a.year - b.year);\n\n  const metaWarnings: string[] = [];\n  if (!historyAvailable) metaWarnings.push(\"No historical series attached. Showing projections only.\");\n  if (historyAvailable && historicalWithIndex.length === 0) metaWarnings.push(\"History bundle attached, but no usable points for this scope.\");\n\n  return {\n    id: scopeKey(opts.scope),\n    scope: opts.scope,\n    cutoverYear,\n    timeline: joined,\n    meta: {\n      notes: [],\n      warnings: metaWarnings,\n      historyAvailable,\n    },\n  };\n}\n\n","import { lazy, Suspense } from \"react\";\nimport { ControlsPanel } from \"../components/ControlsPanel\";\nimport { useModel, scopeLabel } from \"../model/ModelContext\";\nimport { HelpExpander } from \"../components/shared/HelpText\";\nimport { DEFAULT_POLICY_LEVERS_V2, POLICY_PARAMS, listAtBounds, listCalibrationFirstActive, toPolicyV2 } from \"../model/policyRegistry\";\nimport { buildRegionTimeline } from \"../model/history/timeline\";\nimport { resolveMethodology, type PolicyLeversV2 } from \"../model/methodology\";\nimport { sanitizeHistoryBundleWithReport } from \"../security/sanitize\";\nimport {\n  PARTY_ORDER,\n  PARTY_META,\n  PartyChip,\n  type PartyKey,\n  POLICY_KEY_PARTIES,\n  PRESET_PARTIES,\n  summarizePartySupport,\n} from \"../components/policyParty\";\n\nconst AustraliaCrisisMap = lazy(() =>\n  import(\"../components/AustraliaCrisisMap\").then((m) => ({ default: m.AustraliaCrisisMap }))\n);\nconst PriceVsBaseline = lazy(() =>\n  import(\"../components/charts/PriceVsBaseline\").then((m) => ({ default: m.PriceVsBaseline }))\n);\nconst WageVsHousingChart = lazy(() =>\n  import(\"../components/charts/WageVsHousingChart\").then((m) => ({ default: m.default }))\n);\nconst DwellingStockArea = lazy(() =>\n  import(\"../components/charts/OwnershipMixArea\").then((m) => ({ default: m.DwellingStockArea }))\n);\nconst DecileImpact = lazy(() =>\n  import(\"../components/charts/DecileImpact\").then((m) => ({ default: m.DecileImpact }))\n);\nconst PolicyChannelsFlow = lazy(() =>\n  import(\"../components/InvestorFlow\").then((m) => ({ default: m.PolicyChannelsFlow }))\n);\nconst SummaryCounter = lazy(() =>\n  import(\"../components/PublicHousingCounter\").then((m) => ({ default: m.SummaryCounter }))\n);\n\nfunction MicrodataWarningsBanner({ params }: { params: ReturnType<typeof useModel>[\"params\"] }) {\n  const micro = params.advanced?.microDistributions;\n  const enabled = !!micro?.enabled;\n  const meta = (micro?.microdata as any)?.meta as\n    | {\n        warnings?: string[];\n        notes?: string[];\n        inferredMappings?: boolean;\n      }\n    | undefined;\n\n  if (!enabled) return null;\n\n  const warnings = (meta?.warnings ?? []).slice();\n  const inferred = !!meta?.inferredMappings;\n\n  // Missing microdata is a common failure mode; make it explicit.\n  const byCity = (micro?.microdata as any)?.byCity as Record<string, unknown[]> | undefined;\n  if (!byCity || Object.keys(byCity).length === 0) {\n    warnings.unshift(\"Microdata is enabled, but no byCity microdata was provided. Stress metrics will use the proxy.\");\n  }\n\n  if (!inferred && warnings.length === 0) return null;\n\n  return (\n    <div className=\"callout warning\" style={{ marginBottom: 12 }}>\n      <div style={{ fontWeight: 700, marginBottom: 4 }}>Microdata mapping inferred</div>\n      <div style={{ fontSize: 13, lineHeight: 1.5 }}>\n        This run is using inferred column mappings for income/tenure/weights. For reliability, export the normalized\n        schema (`income_annual_aud`, `tenure_code` as R/M/O, optional `weight`) or pass `fields` + `tenureMap`\n        explicitly.\n      </div>\n      {warnings.length > 0 && (\n        <ul style={{ margin: \"8px 0 0 18px\", fontSize: 13 }}>\n          {warnings.slice(0, 3).map((w, i) => (\n            <li key={i}>{w}</li>\n          ))}\n        </ul>\n      )}\n      {meta?.notes?.length ? (\n        <details style={{ marginTop: 8 }}>\n          <summary style={{ cursor: \"pointer\", fontWeight: 600 }}>Show detection details</summary>\n          <ul style={{ margin: \"8px 0 0 18px\", fontSize: 12, color: \"var(--muted)\" }}>\n            {meta.notes.slice(0, 12).map((n, i) => (\n              <li key={i}>{n}</li>\n            ))}\n          </ul>\n        </details>\n      ) : null}\n    </div>\n  );\n}\n\ntype PolicyDifficulty = {\n  rating: \"Easy\" | \"Moderate\" | \"Challenging\" | \"Hard\" | \"Highly Improbable\";\n  score: number;\n  factors: {\n    federal: string[];\n    state: string[];\n    industry: string[];\n    implementation: string[];\n    severity: {\n      federal: \"Low\" | \"Medium\" | \"High\";\n      state: \"Low\" | \"Medium\" | \"High\";\n      industry: \"Low\" | \"Medium\" | \"High\";\n      implementation: \"Low\" | \"Medium\" | \"High\";\n    };\n  };\n  summary: string;\n};\n\nfunction assessPolicyDifficulty(policy: PolicyLeversV2): PolicyDifficulty {\n  let score = 10;\n  const factors: PolicyDifficulty[\"factors\"] = {\n    federal: [] as string[],\n    state: [] as string[],\n    industry: [] as string[],\n    implementation: [] as string[],\n    severity: {\n      federal: \"Low\",\n      state: \"Low\",\n      industry: \"Low\",\n      implementation: \"Low\",\n    },\n  };\n\n  if (policy.negativeGearingMode !== \"none\") {\n    score += 22;\n    factors.federal.push(\"Federal tax changes are sensitive to Senate crossbench and independents.\");\n    factors.industry.push(\"Investor tax concessions are politically sensitive and face strong coordinated pushback.\");\n    factors.industry.push(\"Past reform attempts suggest high likelihood of campaign-style opposition.\");\n  }\n  if (policy.ownershipCapEnabled) {\n    score += 28;\n    factors.implementation.push(\"Ownership caps trigger legal risk and constitutional challenges.\");\n    factors.implementation.push(\"Administrative enforcement complexity can delay passage and weaken design.\");\n    factors.industry.push(\"Likely opposition from property investment lobbies and landlord associations.\");\n  }\n  if (policy.taxInvestor.landTaxShift > 0.2 || policy.stampDutyRateDelta < -0.01) {\n    score += 12;\n    factors.federal.push(\"State revenue exposure creates intergovernmental friction.\");\n    factors.state.push(\"State parliaments control land tax and stamp duty; reform requires state buyin.\");\n    factors.implementation.push(\"Transition funding and compensation become major negotiation points.\");\n  }\n  if (policy.taxInvestor.cgtDiscountDelta < -0.1) {\n    score += 10;\n    factors.federal.push(\"Federal tax measures are exposed to Senate crossbench bargaining.\");\n    factors.industry.push(\"CGT discount reductions often trigger coordinated investor and media lobbying.\");\n  }\n  if (policy.taxInvestor.vacancyTaxIntensity > 0.2 || policy.taxInvestor.shortStayRegulationIntensity > 0.2) {\n    score += 8;\n    factors.industry.push(\"Shortstay platforms, hosts, and landlord groups commonly oppose vacancy/STR rules.\");\n    factors.industry.push(\"Tourism operators and local business groups often weigh in on shortstay rules.\");\n    factors.implementation.push(\"Local government capacity to enforce is a common bottleneck.\");\n  }\n  if (policy.rental.rentRegulationCoverage > 0.2 || policy.rental.rentRegulationCap != null) {\n    score += 16;\n    factors.state.push(\"Tenancy law changes are statebased and can vary widely by jurisdiction.\");\n    factors.industry.push(\"Rent caps or broad coverage face landlord, agent, and investor opposition.\");\n    factors.industry.push(\"Risk of reduced rental listings is a frequent political argument.\");\n  }\n  if (policy.credit.serviceabilityBufferDelta > 0.01 || policy.credit.dtiCapTightness > 0.2) {\n    score += 8;\n    factors.federal.push(\"Macroprudential tightening faces regulator caution (APRA/RBA).\");\n    factors.industry.push(\"Banking sector lobbying is influential on prudential settings.\");\n    factors.industry.push(\"Credit tightening can be framed as firsthomebuyer exclusion.\");\n  }\n  if (policy.publicCommunity.publicHousingBuildBoost > 0.1 || policy.publicCommunity.publicHousingAcquisitionSharePerYear > 0.02) {\n    score += 10;\n    factors.state.push(\"Large public build/acquisition requires longterm funding certainty.\");\n    factors.industry.push(\"Construction capacity and land availability constrain delivery speed.\");\n    factors.implementation.push(\"Procurement timelines and social housing pipeline governance add friction.\");\n  }\n  if (policy.supplyBoost > 0.15 || policy.planning.upzoningIntensity > 0.3) {\n    score += 9;\n    factors.state.push(\"Planning reforms are stateled with local council veto points.\");\n    factors.state.push(\"Local planning appeal processes can slow delivery.\");\n    factors.industry.push(\"Upzoning and rapid supply shifts face NIMBY opposition.\");\n    factors.implementation.push(\"Infrastructure sequencing and developer feasibility can slow rollouts.\");\n  }\n  if (policy.migration.netOverseasMigrationShock < -0.1) {\n    score += 7;\n    factors.federal.push(\"Federal migration settings can be sensitive to Senate crossbench deals.\");\n    factors.industry.push(\"Education sector, business groups, and unions often lobby on migration settings.\");\n    factors.implementation.push(\"Migration cuts intersect with workforce shortages and growth objectives.\");\n  }\n\n  if (policy.subsidies.firstHomeBuyerSubsidyIntensity > 0.15) {\n    score += 4;\n    factors.federal.push(\"Budget scrutiny increases when subsidies are large or ongoing.\");\n    factors.industry.push(\"Large buyer subsidies can be criticized for inflating prices.\");\n  }\n  if (policy.rental.rentAssistanceIntensity > 0.15) {\n    score += 4;\n    factors.federal.push(\"Rent assistance expansions increase fiscal costs and budget scrutiny.\");\n    factors.industry.push(\"Landlord passthrough risk is a common policy critique.\");\n  }\n  if (policy.taxInvestor.foreignBuyerRestrictionIntensity > 0.3) {\n    score += 6;\n    factors.federal.push(\"Diplomatic and trade considerations can slow federal reforms.\");\n    factors.industry.push(\"Foreign buyer restrictions can create trade and investment tensions.\");\n  }\n  if (policy.taxInvestor.vacancyTaxIntensity > 0.4) {\n    score += 4;\n    factors.implementation.push(\"High vacancy tax settings raise enforcement and measurement challenges.\");\n    factors.implementation.push(\"Data sharing between agencies becomes a political and technical hurdle.\");\n  }\n  if (policy.credit.investorLendingLimitTightness > 0.3) {\n    score += 6;\n    factors.federal.push(\"APRA/RBA coordination can slow rapid changes.\");\n    factors.industry.push(\"Investor lending limits often meet coordinated banking sector pushback.\");\n  }\n  if (policy.planning.infrastructureEnablement > 0.4) {\n    score += 6;\n    factors.state.push(\"Infrastructure enablement requires multiyear capital plans and approvals.\");\n    factors.implementation.push(\"State treasury capacity and project pipelines can constrain timing.\");\n  }\n  if (policy.publicCommunity.conversionToSocialSharePerYear > 0.02) {\n    score += 6;\n    factors.implementation.push(\"Rental conversion programs can face legal and compensation disputes.\");\n    factors.industry.push(\"Private rental market groups typically resist compulsory conversion programs.\");\n  }\n  if (policy.ownershipCapEnabled && policy.ownershipCapEnforcement > 0.5) {\n    score += 6;\n    factors.implementation.push(\"High enforcement levels can trigger privacy and compliance pushback.\");\n    factors.implementation.push(\"Data matching across agencies raises governance and civilliberty concerns.\");\n  }\n  if (policy.negativeGearingMode === \"remove\" && policy.negativeGearingIntensity > 0.5) {\n    score += 6;\n    factors.industry.push(\"Rapid phaseouts often amplify shortterm political backlash.\");\n    factors.industry.push(\"Investor sentiment impacts can become a headline risk.\");\n  }\n  if (policy.demandReduction > 0.1) {\n    score += 5;\n    factors.industry.push(\"Large demand reductions can be framed as harming household wealth.\");\n    factors.industry.push(\"Retiree and investor advocacy groups can mobilize quickly.\");\n  }\n  if (policy.supplyBoost > 0.2) {\n    score += 5;\n    factors.industry.push(\"Construction unions and contractors can resist aggressive cost compression.\");\n    factors.implementation.push(\"Very large supply boosts may be seen as unrealistic within workforce limits.\");\n  }\n\n  factors.implementation.push(\"Implementation complexity increases when multiple levers are combined.\");\n  factors.federal.push(\"Stakeholder alignment (state vs federal) is often the decisive constraint.\");\n  factors.state.push(\"State legislative calendars and election cycles can delay or dilute reforms.\");\n\n  const severityFromCount = (n: number): \"Low\" | \"Medium\" | \"High\" =>\n    n >= 4 ? \"High\" : n >= 2 ? \"Medium\" : \"Low\";\n  factors.severity = {\n    federal: severityFromCount(factors.federal.length),\n    state: severityFromCount(factors.state.length),\n    industry: severityFromCount(factors.industry.length),\n    implementation: severityFromCount(factors.implementation.length),\n  };\n\n  score = Math.min(100, score);\n\n  const rating =\n    score <= 18 ? \"Easy\" :\n    score <= 32 ? \"Moderate\" :\n    score <= 52 ? \"Challenging\" :\n    score <= 72 ? \"Hard\" : \"Highly Improbable\";\n\n  const summary = rating === \"Easy\"\n    ? \"Low conflict with entrenched interests; likely to pass if politically prioritized.\"\n    : rating === \"Moderate\"\n    ? \"Some pushback expected, but feasible with negotiation.\"\n    : rating === \"Challenging\"\n    ? \"Multiple stakeholder veto points; passage likely needs strong mandate.\"\n    : rating === \"Hard\"\n    ? \"Significant industry and political resistance expected.\"\n    : \"Would likely require exceptional political alignment or crisis conditions.\";\n\n  return { rating, score, factors, summary };\n}\n\nfunction ScopeIndicator({ scope, cityCount }: { scope: ReturnType<typeof useModel>[\"scope\"]; cityCount: number }) {\n  const label = scopeLabel(scope);\n  const icon =\n    scope.level === \"national\" ? \"\" :\n    scope.level === \"state\" ? \"\" : \"\";\n\n  return (\n    <div className=\"scope-badge\">\n      <span>{icon}</span>\n      <span>{label}</span>\n      {scope.level === \"national\" && (\n        <span className=\"muted\">({cityCount} cities)</span>\n      )}\n    </div>\n  );\n}\n\nfunction CalibrationWarningsBanner({\n  params,\n  calibrationReport,\n}: {\n  params: ReturnType<typeof useModel>[\"params\"];\n  calibrationReport: ReturnType<typeof useModel>[\"calibrationReport\"];\n}) {\n  const policy = toPolicyV2(params.policy as any);\n  const activeCalibrationFirst = listCalibrationFirstActive(policy);\n  const atBounds = listAtBounds(policy);\n\n  const calEnabled = !!params.advanced?.calibration?.enabled;\n  const hasHistory = !!params.advanced?.calibration?.historyByCity;\n\n  const warnings: string[] = [];\n  if (activeCalibrationFirst.length > 0 && (!calEnabled || !hasHistory)) {\n    warnings.push(\n      \"Calibration-first levers are active but no historical series are attached. Treat results as directional.\"\n    );\n  }\n  if (atBounds.length > 0) {\n    warnings.push(\n      `Some levers are at hard bounds (the model clamps to realistic ranges): ${atBounds.slice(0, 4).join(\", \")}${\n        atBounds.length > 4 ? \"\" : \"\"\n      }`\n    );\n  }\n  (calibrationReport?.warnings ?? []).slice(0, 2).forEach((w) => warnings.push(w));\n\n  if (warnings.length === 0) return null;\n\n  return (\n    <div className=\"callout warning\" style={{ marginBottom: 12 }}>\n      <div style={{ fontWeight: 800, marginBottom: 4 }}>Calibration & bounds</div>\n      <ul style={{ margin: \"8px 0 0 18px\", fontSize: 13 }}>\n        {warnings.map((w, i) => (\n          <li key={i}>{w}</li>\n        ))}\n      </ul>\n    </div>\n  );\n}\n\nfunction HistoryWarningsBanner({\n  params,\n}: {\n  params: ReturnType<typeof useModel>[\"params\"];\n}) {\n  const bundle = params.advanced?.calibration?.historyBundle as any;\n  if (!bundle) return null;\n  const warnings: string[] = [];\n  const metaWarnings = bundle?.meta?.warnings as string[] | undefined;\n  const notes = bundle?.meta?.notes as string[] | undefined;\n  if (Array.isArray(metaWarnings) && metaWarnings.length) warnings.push(...metaWarnings.slice(0, 3));\n  if (warnings.length === 0) return null;\n  return (\n    <div className=\"callout warning\" style={{ marginBottom: 12 }}>\n      <div style={{ fontWeight: 800, marginBottom: 4 }}>Historical data coverage</div>\n      <ul style={{ margin: \"8px 0 0 18px\", fontSize: 13 }}>\n        {warnings.map((w, i) => (\n          <li key={i}>{w}</li>\n        ))}\n      </ul>\n      {Array.isArray(notes) && notes.length ? (\n        <details style={{ marginTop: 8 }}>\n          <summary style={{ cursor: \"pointer\", fontWeight: 600 }}>Show history notes</summary>\n          <ul style={{ margin: \"8px 0 0 18px\", fontSize: 12, color: \"var(--muted)\" }}>\n            {notes.slice(0, 10).map((n, i) => (\n              <li key={i}>{n}</li>\n            ))}\n          </ul>\n        </details>\n      ) : null}\n    </div>\n  );\n}\n\nfunction SanitizationBanner({ params }: { params: ReturnType<typeof useModel>[\"params\"] }) {\n  const msgs: string[] = [];\n\n  const microMeta = (params.advanced?.microDistributions as any)?.microdata?.meta as any;\n  const m = microMeta?.sanitization;\n  if (m && (m.droppedCityKeys || m.droppedRows || m.truncatedRows)) {\n    msgs.push(\n      `Microdata sanitized: dropped ${m.droppedCityKeys} invalid city keys, dropped ${m.droppedRows} non-object rows, truncated ${m.truncatedRows} rows (cap ${m.maxRowsPerCity}/city).`\n    );\n  }\n\n  const hb = params.advanced?.calibration?.historyBundle as any;\n  if (hb) {\n    const rep = sanitizeHistoryBundleWithReport(hb).report;\n    if (rep.ok && (rep.droppedCityKeys || rep.cappedPoints)) {\n      msgs.push(\n        `History bundle sanitized: dropped ${rep.droppedCityKeys} invalid city keys, capped ${rep.cappedPoints} year-points (max ${rep.maxYears} years).`\n      );\n    }\n  }\n\n  if (msgs.length === 0) return null;\n  return (\n    <div className=\"callout warning\" style={{ marginBottom: 12 }}>\n      <div style={{ fontWeight: 800, marginBottom: 4 }}>Input sanitization applied</div>\n      <ul style={{ margin: \"8px 0 0 18px\", fontSize: 13 }}>\n        {msgs.map((m, i) => (\n          <li key={i}>{m}</li>\n        ))}\n      </ul>\n    </div>\n  );\n}\n\nexport function ExploreModel() {\n  const {\n    scope,\n    scopedView,\n    selectedCityData,\n    params,\n    outputs,\n    calibrationReport,\n    showHistory,\n    historyIndexBase,\n    focusYear,\n    setFocusYear,\n    selectedPresets,\n  } = useModel();\n\n  const { years } = scopedView;\n  const first = years[0];\n\n  if (!first || years.length === 0) {\n    return (\n      <div style={{ padding: 40, textAlign: \"center\" }}>\n        <div style={{ fontSize: 24, marginBottom: 16 }}></div>\n        <div className=\"h2\">Loading simulation...</div>\n        <div className=\"muted\">Calculating outcomes for {params.cities.length} cities</div>\n      </div>\n    );\n  }\n\n  // Get decile data from city-level if available\n  const decileRows =\n    selectedCityData?.years[selectedCityData.years.length - 1]?.deciles.rows ?? null;\n\n  // Timeline for charts (historical + projected if available and enabled)\n  const { c } = resolveMethodology(params);\n  const timelineView = showHistory\n    ? buildRegionTimeline({\n        outputs,\n        scope,\n        historyBundle: params.advanced?.calibration?.historyBundle as any,\n        cities: params.cities,\n        c,\n        stampDutyRate: c.stampDutyEffectiveRate + ((params.policy as any).stampDutyRateDelta ?? 0),\n        year0: first.year,\n        indexBase: historyIndexBase,\n      })\n    : null;\n  const chartSeries = timelineView ? timelineView.timeline : years;\n  const cutoverYear = timelineView ? timelineView.cutoverYear : first.year;\n  const selectedYear = focusYear ?? (chartSeries as any)[(chartSeries as any).length - 1]?.year ?? first.year;\n  const baseValueForIndex = (() => {\n    const baseYear = historyIndexBase === \"year0\" ? first.year : chartSeries[0]?.year;\n    const basePoint = chartSeries.find((p: any) => p.year === baseYear) as any;\n    return {\n      medianPrice: (basePoint?.medianPrice ?? first.medianPrice) as number,\n      medianAnnualRent: (basePoint?.medianAnnualRent ?? first.medianAnnualRent) as number,\n    };\n  })();\n\n  const policy = toPolicyV2(params.policy as any);\n  const defaultPolicy = DEFAULT_POLICY_LEVERS_V2;\n  const policyDifficulty = assessPolicyDifficulty(policy);\n\n  const getByPath = (obj: any, path: string) => {\n    return path.split(\".\").reduce((acc, key) => (acc ? acc[key] : undefined), obj);\n  };\n\n  const formatPolicyValue = (key: string, value: any): string => {\n    if (value == null) return \"n/a\";\n    if (key.includes(\"rentRegulationCap\")) return `${Math.round(value * 100)}% cap`;\n    if (typeof value === \"boolean\") return value ? \"enabled\" : \"disabled\";\n    if (Math.abs(value) < 1e-9) return \"0\";\n    if (key.includes(\"Rate\") || key.includes(\"Delta\")) return `${(value * 100).toFixed(1)}pp`;\n    if (key.includes(\"Intensity\") || key.includes(\"Share\") || key.includes(\"Boost\")) return `${Math.round(value * 100)}%`;\n    if (key.includes(\"LagYears\") || key.includes(\"rampYears\")) return `${value} years`;\n    return `${Math.round(value * 100)}%`;\n  };\n\n  const manualChanges = (() => {\n    const changes: { key: string; label: string; value: string; parties: PartyKey[] }[] = [];\n    POLICY_PARAMS.forEach((param) => {\n      const current = getByPath(policy as any, param.key);\n      const baseline = getByPath(defaultPolicy as any, param.key);\n      const different = param.key === \"rental.rentRegulationCap\" ? current !== baseline : current !== baseline;\n      if (!different) return;\n      changes.push({\n        key: param.key,\n        label: param.label,\n        value: formatPolicyValue(param.key, current),\n        parties: POLICY_KEY_PARTIES[param.key] ?? [],\n      });\n    });\n\n    if (policy.negativeGearingMode !== defaultPolicy.negativeGearingMode) {\n      changes.push({\n        key: \"negativeGearingMode\",\n        label: \"Negative gearing mode\",\n        value: policy.negativeGearingMode,\n        parties: POLICY_KEY_PARTIES.negativeGearingMode ?? [],\n      });\n    }\n    if (policy.negativeGearingIntensity !== defaultPolicy.negativeGearingIntensity) {\n      changes.push({\n        key: \"negativeGearingIntensity\",\n        label: \"Negative gearing intensity\",\n        value: formatPolicyValue(\"negativeGearingIntensity\", policy.negativeGearingIntensity),\n        parties: POLICY_KEY_PARTIES.negativeGearingIntensity ?? [],\n      });\n    }\n    if (policy.ownershipCapEnabled !== defaultPolicy.ownershipCapEnabled) {\n      changes.push({\n        key: \"ownershipCapEnabled\",\n        label: \"Ownership cap\",\n        value: policy.ownershipCapEnabled ? \"enabled\" : \"disabled\",\n        parties: POLICY_KEY_PARTIES.ownershipCapEnabled ?? [],\n      });\n    }\n    if (policy.ownershipCapEnforcement !== defaultPolicy.ownershipCapEnforcement) {\n      changes.push({\n        key: \"ownershipCapEnforcement\",\n        label: \"Ownership cap enforcement\",\n        value: formatPolicyValue(\"ownershipCapEnforcement\", policy.ownershipCapEnforcement),\n        parties: POLICY_KEY_PARTIES.ownershipCapEnforcement ?? [],\n      });\n    }\n    if (policy.excessInvestorStockShare !== defaultPolicy.excessInvestorStockShare) {\n      changes.push({\n        key: \"excessInvestorStockShare\",\n        label: \"Excess investor stock share\",\n        value: formatPolicyValue(\"excessInvestorStockShare\", policy.excessInvestorStockShare),\n        parties: POLICY_KEY_PARTIES.excessInvestorStockShare ?? [],\n      });\n    }\n    if (policy.divestmentPhased !== defaultPolicy.divestmentPhased) {\n      changes.push({\n        key: \"divestmentPhased\",\n        label: \"Divestment phasing\",\n        value: policy.divestmentPhased ? \"phased\" : \"immediate\",\n        parties: POLICY_KEY_PARTIES.divestmentPhased ?? [],\n      });\n    }\n    if (policy.stampDutyRateDelta !== defaultPolicy.stampDutyRateDelta) {\n      changes.push({\n        key: \"stampDutyRateDelta\",\n        label: \"Stamp duty rate delta\",\n        value: formatPolicyValue(\"stampDutyRateDelta\", policy.stampDutyRateDelta),\n        parties: POLICY_KEY_PARTIES.stampDutyRateDelta ?? [],\n      });\n    }\n    if (policy.mortgageRateDelta !== defaultPolicy.mortgageRateDelta) {\n      changes.push({\n        key: \"mortgageRateDelta\",\n        label: \"Mortgage rate delta\",\n        value: formatPolicyValue(\"mortgageRateDelta\", policy.mortgageRateDelta),\n        parties: POLICY_KEY_PARTIES.mortgageRateDelta ?? [],\n      });\n    }\n    if (policy.rampYears !== defaultPolicy.rampYears) {\n      changes.push({\n        key: \"rampYears\",\n        label: \"Policy ramp years\",\n        value: formatPolicyValue(\"rampYears\", policy.rampYears),\n        parties: POLICY_KEY_PARTIES.rampYears ?? [],\n      });\n    }\n    return changes;\n  })();\n\n  const activePresets = selectedPresets.filter((p) => p !== \"baseline\");\n  const presetParties = activePresets.flatMap((p) => PRESET_PARTIES[p] ?? []);\n  const manualParties = manualChanges.flatMap((c) => c.parties);\n  const partySummary = summarizePartySupport([...presetParties, ...manualParties]);\n\n  const partyKeyLabel = partySummary.top.length\n    ? partySummary.top.map((p) => PARTY_META[p].label).join(\" / \")\n    : \"None (baseline only)\";\n\n  return (\n    <div className=\"explore-layout\">\n      {/* Sidebar with controls */}\n      <aside className=\"explore-sidebar\">\n        <ControlsPanel />\n      </aside>\n\n      {/* Main content area with charts */}\n      <div className=\"explore-main\">\n        <div className=\"explore-header\">\n          <div>\n            <h1 className=\"h1\" style={{ margin: 0 }}>Explore the model</h1>\n            <p className=\"muted\" style={{ margin: \"4px 0 0 0\", fontSize: 14 }}>\n              Adjust controls on the left. Results update instantly.\n            </p>\n            <p className=\"muted\" style={{ margin: \"6px 0 0 0\", fontSize: 12 }}>\n              This model is a free tool developed by the not-for-profit consumer advocacy and research team at SOCii.\n            </p>\n          </div>\n          <ScopeIndicator scope={scope} cityCount={params.cities.length} />\n        </div>\n\n        <CalibrationWarningsBanner params={params} calibrationReport={calibrationReport} />\n        <SanitizationBanner params={params} />\n        <HistoryWarningsBanner params={params} />\n        <MicrodataWarningsBanner params={params} />\n\n        {/* Year filter for fast map focus */}\n        <div className=\"card\" style={{ padding: 12, marginBottom: 10 }}>\n          <div style={{ display: \"flex\", alignItems: \"center\", justifyContent: \"space-between\", gap: 12 }}>\n            <div>\n              <div style={{ fontWeight: 700 }}>Year focus</div>\n              <div className=\"muted\" style={{ fontSize: 12 }}>\n                Jump to a specific year; charts and map will highlight that year.\n              </div>\n            </div>\n            <div style={{ display: \"flex\", alignItems: \"center\", gap: 8 }}>\n              <select\n                className=\"select-field\"\n                value={selectedYear}\n                onChange={(e) => setFocusYear(Number(e.target.value))}\n                aria-label=\"Select focus year\"\n              >\n                {(chartSeries as any).map((p: any) => (\n                  <option key={`yr-${p.year}`} value={p.year}>\n                    {p.year}\n                  </option>\n                ))}\n              </select>\n              <button\n                type=\"button\"\n                className=\"btn-reset\"\n                onClick={() => setFocusYear(null)}\n                title=\"Return to latest year\"\n              >\n                Latest\n              </button>\n            </div>\n          </div>\n        </div>\n\n        {/* Regional crisis heatmap (national context, live-updating by hovered year) */}\n        <Suspense fallback={<div className=\"card\" style={{ padding: 16 }}>Loading map</div>}>\n          <AustraliaCrisisMap\n            outputs={outputs}\n            params={params as any}\n            year={selectedYear}\n            historyBundle={params.advanced?.calibration?.historyBundle as any}\n            title={`Regional crisis heatmap  ${scopeLabel(scope)}`}\n            scope={scope}\n          />\n        </Suspense>\n\n        {/* Primary charts - immediately visible */}\n        <div className=\"chart-grid-primary\">\n          <Suspense fallback={<div className=\"card\" style={{ padding: 16 }}>Loading chart</div>}>\n            <PriceVsBaseline\n              title=\"Housing prices\"\n              series={chartSeries as any}\n              dataKey=\"medianPrice\"\n              baseValue={baseValueForIndex.medianPrice}\n              cutoverYear={cutoverYear}\n              onHoverYear={setFocusYear}\n            />\n          </Suspense>\n          <Suspense fallback={<div className=\"card\" style={{ padding: 16 }}>Loading chart</div>}>\n            <PriceVsBaseline\n              title=\"Rents\"\n              series={chartSeries as any}\n              dataKey=\"medianAnnualRent\"\n              baseValue={baseValueForIndex.medianAnnualRent}\n              cutoverYear={cutoverYear}\n              onHoverYear={setFocusYear}\n            />\n          </Suspense>\n        </div>\n\n        {/* Summary metrics */}\n        <Suspense fallback={<div className=\"card\" style={{ padding: 16 }}>Loading summary</div>}>\n          <SummaryCounter />\n        </Suspense>\n\n        {/* Wage vs Housing comparison */}\n        <Suspense fallback={<div className=\"card\" style={{ padding: 16 }}>Loading chart</div>}>\n          <WageVsHousingChart\n            years={chartSeries as any}\n            scopeLabel={scopeLabel(scope)}\n            cutoverYear={cutoverYear}\n            onHoverYear={setFocusYear}\n          />\n        </Suspense>\n\n        {/* Secondary charts */}\n        <div className=\"chart-grid-secondary\">\n          <Suspense fallback={<div className=\"card\" style={{ padding: 16 }}>Loading chart</div>}>\n            <DwellingStockArea series={chartSeries as any} onHoverYear={setFocusYear} />\n          </Suspense>\n          {selectedCityData && (\n            <Suspense fallback={<div className=\"card\" style={{ padding: 16 }}>Loading chart</div>}>\n              <PolicyChannelsFlow series={selectedCityData.years} />\n            </Suspense>\n          )}\n        </div>\n\n        {/* Decile analysis */}\n        {decileRows && (\n          <div className=\"decile-section\">\n            <div className=\"section-header\">\n              <h2 className=\"h2\" style={{ margin: 0 }}>Distributional impact</h2>\n              <span className=\"badge-warning\">Proxy estimate</span>\n            </div>\n            <Suspense fallback={<div className=\"card\" style={{ padding: 16 }}>Loading distribution</div>}>\n              <DecileImpact rows={decileRows} />\n            </Suspense>\n          </div>\n        )}\n\n        {/* Interpretation guide - collapsible */}\n        <details className=\"help-panel\">\n          <summary className=\"help-panel-trigger\">\n            <span></span>\n            <span>How to interpret results</span>\n          </summary>\n          <div className=\"help-panel-content\">\n            <HelpExpander summary=\"Understanding the charts\" defaultOpen>\n              <ul>\n                <li><strong>Price/Rent index:</strong> 100 = no change, 200 = doubled</li>\n                <li><strong>Stock vs demand:</strong> Gap = market tightness</li>\n                <li><strong>Trend colors:</strong> Green = improving, Red = worsening</li>\n              </ul>\n            </HelpExpander>\n            <HelpExpander summary=\"Common questions\">\n              <ul>\n                <li><strong>Why do rents increase with NG removal?</strong> Short-term rental supply shock</li>\n                <li><strong>Why delayed ownership cap effects?</strong> Divestment over ramp period</li>\n              </ul>\n            </HelpExpander>\n          </div>\n        </details>\n\n        {/* Policy summary */}\n        <div className=\"card\" style={{ padding: 16, marginTop: 14 }}>\n          <div className=\"h2\" style={{ marginTop: 0 }}>Policy summary</div>\n          <div className=\"muted\" style={{ fontSize: 13, marginBottom: 10 }}>\n            Summary of selected policies and their typical party associations. This is informational only and not an endorsement.\n          </div>\n\n          <div style={{ display: \"flex\", flexWrap: \"wrap\", gap: 6, marginBottom: 12 }}>\n            <span style={{ fontSize: 12, fontWeight: 700, color: \"var(--muted)\" }}>Color key:</span>\n            {PARTY_ORDER.map((p) => (\n              <PartyChip key={`legend-${p}`} party={p} />\n            ))}\n          </div>\n\n          <div style={{ display: \"grid\", gap: 10 }}>\n            <div>\n              <div style={{ fontWeight: 700, marginBottom: 6 }}>Active presets</div>\n              {activePresets.length === 0 ? (\n                <div className=\"muted\" style={{ fontSize: 13 }}>Baseline only (no preset selected).</div>\n              ) : (\n                <ul style={{ margin: 0, paddingLeft: 18, fontSize: 13 }}>\n                  {activePresets.map((p) => (\n                    <li key={p} style={{ display: \"flex\", alignItems: \"center\", gap: 8, marginBottom: 4 }}>\n                      <span>{p}</span>\n                      {(PRESET_PARTIES[p] ?? []).map((party) => (\n                        <PartyChip key={`${p}-${party}`} party={party} />\n                      ))}\n                    </li>\n                  ))}\n                </ul>\n              )}\n            </div>\n\n            <div>\n              <div style={{ fontWeight: 700, marginBottom: 6 }}>Manual adjustments</div>\n              {manualChanges.length === 0 ? (\n                <div className=\"muted\" style={{ fontSize: 13 }}>No manual policy changes from baseline.</div>\n              ) : (\n                <ul style={{ margin: 0, paddingLeft: 18, fontSize: 13 }}>\n                  {manualChanges.map((c) => (\n                    <li key={c.key} style={{ display: \"flex\", alignItems: \"center\", gap: 8, marginBottom: 4 }}>\n                      <span>{c.label}: <strong>{c.value}</strong></span>\n                      {c.parties.map((party) => (\n                        <PartyChip key={`${c.key}-${party}`} party={party as any} />\n                      ))}\n                    </li>\n                  ))}\n                </ul>\n              )}\n            </div>\n\n            <div style={{ paddingTop: 6, borderTop: \"1px solid var(--border)\" }}>\n              <div style={{ fontWeight: 700, marginBottom: 6 }}>Most represented party in selected policies</div>\n              <div style={{ display: \"flex\", alignItems: \"center\", gap: 8 }}>\n                <span>{partyKeyLabel}</span>\n                {partySummary.top.map((p) => (\n                  <PartyChip key={`top-${p}`} party={p} />\n                ))}\n              </div>\n              <div className=\"muted\" style={{ fontSize: 12, marginTop: 6 }}>\n                Based on the count of party associations across your selected policies (presets + manual adjustments).\n              </div>\n            </div>\n\n            <div style={{ paddingTop: 10, borderTop: \"1px solid var(--border)\" }}>\n              <div style={{ fontWeight: 700, marginBottom: 6 }}>Feasibility & pushback assessment</div>\n              <div style={{ display: \"flex\", alignItems: \"center\", gap: 8, marginBottom: 6 }}>\n                <span style={{ fontSize: 13 }}>\n                  Difficulty: <strong>{policyDifficulty.rating}</strong>\n                </span>\n                <span className=\"muted\" style={{ fontSize: 12 }}>\n                  (score {policyDifficulty.score}/100)\n                </span>\n              </div>\n              <div className=\"muted\" style={{ fontSize: 12, marginBottom: 8 }}>\n                {policyDifficulty.summary}\n              </div>\n              {Object.values(policyDifficulty.factors).some((xs) => Array.isArray(xs) && xs.length > 0) && (\n                <div style={{ display: \"grid\", gap: 8, fontSize: 12 }}>\n                  {(\n                    [\n                      [\"Federal\", policyDifficulty.factors.federal, policyDifficulty.factors.severity.federal],\n                      [\"State\", policyDifficulty.factors.state, policyDifficulty.factors.severity.state],\n                      [\"Industry\", policyDifficulty.factors.industry, policyDifficulty.factors.severity.industry],\n                      [\"Implementation\", policyDifficulty.factors.implementation, policyDifficulty.factors.severity.implementation],\n                    ] as Array<[string, string[], \"Low\" | \"Medium\" | \"High\"]>\n                  ).map(([label, items, severity]) =>\n                    items.length ? (\n                      <details key={label} className=\"help-panel\" style={{ padding: 10 }}>\n                        <summary className=\"help-panel-trigger\" style={{ gap: 8 }}>\n                          <span>{label}</span>\n                          <span className=\"muted\" style={{ fontSize: 11 }}>\n                            Severity: <strong>{severity}</strong>\n                          </span>\n                        </summary>\n                        <div className=\"help-panel-content\">\n                          <ul style={{ margin: \"8px 0 0 18px\" }}>\n                            {items.map((f, i) => (\n                              <li key={`${label}-${i}`}>{f}</li>\n                            ))}\n                          </ul>\n                        </div>\n                      </details>\n                    ) : null\n                  )}\n                </div>\n              )}\n              <div className=\"muted\" style={{ fontSize: 11, marginTop: 8 }}>\n                Heuristic assessment only; actual feasibility depends on timing, coalitions, and implementation details.\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n"],"file":"ExploreModel-OJRoENv_.js"}